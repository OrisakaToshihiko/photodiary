"use strict";function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,n,r=!0,l=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return r=e.done,e},e:function(e){l=!0,n=e},f:function(){try{r||null==i.return||i.return()}finally{if(l)throw n}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function getPageScroll(){var e,t;return self.pageYOffset?(t=self.pageYOffset,e=self.pageXOffset):document.documentElement&&document.documentElement.scrollTop?(t=document.documentElement.scrollTop,e=document.documentElement.scrollLeft):document.body&&(t=document.body.scrollTop,e=document.body.scrollLeft),new Array(e,t)}function getPageHeight(){var e;return self.innerHeight?e=self.innerHeight:document.documentElement&&document.documentElement.clientHeight?e=document.documentElement.clientHeight:document.body&&(e=document.body.clientHeight),e}function setCookie(e,t,a){var i=escape(e)+"="+escape(t);if(null!=a){var n=new Date;n.setDate(n.getDate()+a),i+=";expires="+n.toGMTString()}document.cookie=i}function getCookie(e){if(document.cookie)for(var t=document.cookie.split(";"),a=0;a<t.length;a++){var i=t[a].replace(/\s/g,"").split("=");if(i[0]==escape(e))return unescape(i[1])}return""}function MTAppRemovedMessage(e,t,a){a="string"==typeof a?a:"",console.warn(e+" は MTAppjQuery "+t+" で削除されました。"+a)}!function(e){if("object"===("undefined"==typeof mtappVars?"undefined":_typeof(mtappVars))){document.getElementById("category-ids");e.fn.MTAppAssetFields=function(t,a){var i=e.extend({},e.fn.MTAppAssetFields.defaults,t),n="ja"===mtappVars.language?"ja":"en",r=(a=a||{},e.extend({},e.fn.MTAppAssetFields.l10n[n],a));e("body").append(['<script type="text/javascript">',"function insertCustomFieldAsset(html, id, preview_html) {","    getByID(id).value = html;","    if ( !preview_html )","        preview_html = html ? html : '';","    try {","        /* remove the form enclosure from the preview */",'        var enc = document.createElement( "div" );',"        enc.innerHTML = preview_html;",'        var form = enc.getElementsByTagName( "form" )[ 0 ];',"        getByID(id + '_preview').innerHTML = form ? form.innerHTML : preview_html;","    } catch(e) { ","        log.error(e);","    };","    var remove_button = getByID(id + '_remove_asset');","    if (remove_button && html) {","        TC.removeClassName(getByID(id + '_remove_asset'), 'hidden');","    }","    else if (remove_button) {","        TC.addClassName(getByID(id + '_remove_asset'), 'hidden');","    }","}","<\/script>"].join("")),e("body").data("MTAppAssetFieldsIDs")||e("body").data("MTAppAssetFieldsIDs",[]);return this.closest("form").off("submit.MTAppAssetFieldsSubmit").on("submit.MTAppAssetFieldsSubmit",(function(){for(var t=e("body").data("MTAppAssetFieldsIDs"),a=0,i=t.length;a<i;a++)e("#"+t[a]).not(".no-convert").trigger("convert");return!0})),this.each((function(){var t=e(this);if(i.debug||t.hide(),i.noConvert&&t.addClass("no-convert"),!t.hasClass("isMTAppAssetFields")){t.addClass("isMTAppAssetFields"),t.data("MTAppAssetFieldsValue",t.val());var a=t.attr("id")||mtapp.temporaryId("temp-");return a="customfield_mtappassetfields_"+a,e("body").data("MTAppAssetFieldsIDs").push(a),t.attr("id",a),t.on("refreshHTML",(function(n,l){t.nextAll("div.MTAppAssetFields").remove();var s="";s=""!==i.assetTypeLabel?i.assetTypeLabel:r[i.assetType];var o=t.val();if(o)try{o=JSON.parse(o)}catch(e){alert(e.message)}var p="",d="hidden";if(o.url){if("image"===i.assetType)if("force"===l&&void 0===o.thumbnail&&"object"===_typeof(mtappVars.DataAPI)){var c=mtapp.temporaryId("temp-");p='<a href="'+o.url+'" target="_blank"><img id="'+c+'" src="" alt="" style="display: none;"></a>',function(t,a){mtappVars.DataAPI.getThumbnail(mtappVars.blog_id,o.id,{width:240,height:240},(function(i){var n=i.url;e("#"+t).attr("src",n).fadeIn();var r=',"thumbnail":"'+n+'"}',l=a.val().replace(/\}$/,r);a.val(l)}))}(c,t)}else p=o.thumbnail?'<a href="'+o.url+'" target="_blank"><img src="'+o.thumbnail+'" alt=""></a>':'<a href="'+o.url+'" target="_blank"><img src="'+o.url+'" alt=""></a>';else"file"!==i.assetType&&"audio"!==i.assetType||(p='<a href="'+o.url+'" target="_blank">'+o.filename+"</a>");d=""}var u=i.canMulti?"&amp;can_multi=1":"",m=['<div id="'+a+'_preview" class="customfield_preview MTAppAssetFields">',p,"</div>",'<div class="actions-bar MTAppAssetFields" style="clear: none;">','<div class="actions-bar-inner pkg actions">','<a href="'+ScriptURI+"?__mode=list_asset&amp;_type=asset&amp;blog_id="+mtappVars.blog_id+"&amp;dialog_view=1&amp;filter=class&amp;filter_val="+i.assetType+"&amp;require_type="+i.assetType+"&amp;edit_field="+a+u+'&amp;asset_select=1" class="btn btn-default mt-2 mt-open-dialog mt-modal-open mtapp-open-modal" data-mt-modal-large>',s+r.select,"</a>",'<a href="#" id="'+a+'_remove_asset" class="btn btn-default mt-2 ml-2'+d+"\" onclick=\"insertCustomFieldAsset('', '"+a+"'); return false;\">",s+r.remove,"</a>","</div>","</div>"].join("");t.after(m)})),t.trigger("refreshHTML"),t.next().next().find(".mtapp-open-modal").mtModal(),t.on("convert",(function(){var t=e(this),a=t.val();if(/<form mt:asset-id/.test(a)){a=a.replace(/<form mt:asset-id="(\d+)".+?href="([^"]+)">([^<]+).+/gi,'{"id":"$1","filename":"$3","url":"$2"}');var i=t.next().find("img");if(i.length>0){var n=i.attr("src");a=a.replace(/\}$/,',"thumbnail":"'+n+'"}')}t.val(a),t.hasClass("jsontable-input")&&t.closest("div.mtapp-json-table").prev().trigger("MTAppJSONTableSave")}})),!0}}))},e.fn.MTAppAssetFields.l10n={en:{image:"Image",file:"File",audio:"Audio",select:" Select",remove:" Remove"},ja:{image:"画像",file:"ファイル",audio:"オーディオ",select:"を選択",remove:"を削除"}},e.fn.MTAppAssetFields.defaults={assetType:"image",assetTypeLabel:"",edit:!1,noConvert:!1,canMulti:!1,debug:!1},e.fn.MTAppJSONTable=function(t){var a=e.extend({inputType:"textarea",caption:null,header:null,headerOrder:[],headerPosition:"top",footer:!1,items:null,itemsRootKey:"items",edit:!0,add:!1,clear:!0,cellMerge:!1,sortable:!1,listingCheckbox:!1,listingCheckboxType:"checkbox",listingTargetKey:null,listingTargetEscape:!1,optionButtons:null,cbAfterBuildSystem:null,cbAfterBuild:null,cbBeforeAdd:null,cbAfterAddSystem:null,cbAfterAdd:null,cbBeforeClear:null,cbAfterSelectRow:null,cbAfterSelectColumn:null,cbBeforeSave:null,cbAfterSave:null,nest:!1,debug:!1},t),i={};return"ja"===mtappVars.language?(i.addRow="行を追加",i.addColumn="列を追加",i.clearData="削除",i.showJSON="JSONを表示",i.hideJSON="JSONを非表示",i.debugMessage="フィールドが表示されているときはテーブル内の値は無視され、フィールド内の JSON がそのまま保存されます。",i.checkSyntax="JSONの文法をチェック",i.addColumnProperty="プロパティ名（例：title）",i.addColumnPropertyDisplayName="プロパティ表示名（例：タイトル）",i.cellMerge="セルを結合",i.cellMergeApply="結合を適用",i.colspanValueIs="結合する列の数",i.rowspanValueIs="結合する行の数",i.failedSelect="連続したセルを選択してください"):(i.addRow="Add a row",i.addColumn="Add a column",i.clearData="Delete",i.showJSON="Show JSON",i.hideJSON="Hide JSON",i.debugMessage="When the field is visible, ignore table values and save JSON.",i.checkSyntax="Check JSON syntax",i.addColumnProperty="Property Name (e.g. title)",i.addColumnPropertyDisplayName="Property Display Name (e.g. Title)",i.cellMerge="Merge cells",i.cellMergeApply="Apply merge",i.colspanValueIs="The value of colspan:",i.rowspanValueIs="The value of rowspan:",i.failedSelect="Failed to select"),a.clear&&(a.listingCheckbox=!0),this.each((function(){var t=a.headerOrder;if(e.isArray(t)&&0===t.length)alert('Error in .MTAppJSONTable: The "headerOrder" option is required.');else{var n=e(this);n.addClass("hidden").css({marginBottom:"10px"});var r=n.val(),l=null;if(/^\{/.test(r))try{l=JSON.parse(r)}catch(e){alert(e.message)}else null===a.items?(l={})[a.itemsRootKey]=[]:l=a.items;if(null!==l){var s=l[a.itemsRootKey];if(0===s.length){s[0]={};for(var o=0,p=t.length;o<p;o++)s[0][t[o]]=""}if(!a.cellMerge)for(var d=0,c=t.length;d<c;d++)for(var u=0,m=s.length;u<m;u++)s[u].hasOwnProperty(t[d])||(s[u][t[d]]="");for(var f=0,h=s.length;f<h;f++)for(var g in s[f])"string"==typeof s[f][g]?s[f][g]=s[f][g].encodeHTML():"object"===_typeof(s[f][g])&&(s[f][g]=JSON.stringify(s[f][g]));a.items=s;var b=a.items.length,v={caption:"<caption>[#= caption #]</caption>"};v.header=["<thead>","<tr>","[# if (sortable) { #]",'<th class="jsontable-sort-handle">&nbsp;</th>',"[# } #]","[# if (listingCheckbox) { #]",'<th class="jsontable-cb-cell">&nbsp;</th>',"[# } #]","[# for (let i = 0, l = headerOrder.length; i < l; i++) { #]",'<th class="[#= headerOrder[i] #]" data-name="[#= headerOrder[i] #]">[#= header[headerOrder[i]] #]</th>',"[# } #]","</tr>","</thead>"].join("\n"),v.footer=["<tfoot>","<tr>","[# if (sortable) { #]",'<th class="mt-table-thead-th jsontable-sort-handle">&nbsp;</th>',"[# } #]","[# if (listingCheckbox) { #]",'<th class="mt-table-thead-th jsontable-cb-cell">&nbsp;</th>',"[# } #]","[# for (let i = 0, l = headerOrder.length; i < l; i++) { #]",'<th class="mt-table-thead-th [#= headerOrder[i] #]" data-name="[#= headerOrder[i] #]">[#= header[headerOrder[i]] #]</th>',"[# } #]","</tr>","</tfoot>"].join("\n"),v.tbodyTopPlain=['<tr class="odd">',"[# if (sortable) { #]",'<td class="jsontable-sort-handle"><svg role="img" title="移動" class="mt-icon"><use xlink:href="'+mtappVars.static_path+'images/sprite.svg#ic_move"></use></svg></td>',"[# } #]","[# if (listingCheckbox) { #]",'<td class="jsontable-cb-cell">','[# if (listingCheckboxType === "radio") { #]','<input type="radio" name="jsontable-radio" class="jsontable-cb">',"[# } else { #]",'<input type="checkbox" class="jsontable-cb">',"[# } #]","</td>","[# } #]","[# for (let x = 0, y = headerOrder.length; x < y; x++) { #]",'<td class="[#= headerOrder[x] #]" data-name="[#= headerOrder[x] #]">','[# if (inputType === "input" || (inputType === "object" && inputTypeObj[headerOrder[x]] && inputTypeObj[headerOrder[x]] === "input") ) { #]','<input class="form-control jsontable-input" type="text" data-name="[#= headerOrder[x] #]" value="">','[# } else if (inputType === "textarea" || (inputType === "object" && inputTypeObj[headerOrder[x]] && inputTypeObj[headerOrder[x]] === "textarea") ) { #]','<textarea class="form-control jsontable-input" data-name="[#= headerOrder[x] #]"></textarea>',"[# } #]","</td>","[# } #]","</tr>"].join(""),v.tbodyTop=['<tbody class="jsontable-tbody">',"[# for (let i = 0, l = items.length; i < l; i++) { #]","[# if (i % 2 === 0) { #]",'<tr class="even">',"[# } else { #]",'<tr class="odd">',"[# } #]","[# if (sortable) { #]",'<td class="jsontable-sort-handle"><svg role="img" title="移動" class="mt-icon"><use xlink:href="'+mtappVars.static_path+'images/sprite.svg#ic_move"></use></svg></td>',"[# } #]","[# if (listingCheckbox) { #]",'<td class="jsontable-cb-cell">','[# if (listingCheckboxType === "radio") { #]','<input type="radio" name="jsontable-radio" class="jsontable-cb">',"[# } else { #]",'<input type="checkbox" class="jsontable-cb">',"[# } #]","</td>","[# } #]","[# for (let x = 0, y = headerOrder.length; x < y; x++) { #]","[# if (!items[i].hasOwnProperty(headerOrder[x])) { continue; } #]",'<td class="[#= headerOrder[x] #]" data-name="[#= headerOrder[x] #]"',"[# if (listingTargetKey && listingTargetKey === headerOrder[x]) { #]","[# if (listingTargetEscape) { #]",'data-value="[#= encodeURIComponent(items[i][headerOrder[x]]) #]"',"[# } else { #]",'data-value="[#= items[i][headerOrder[x]] #]"',"[# } #]","[# } #]",'[# if (items[i].hasOwnProperty(headerOrder[x] + "_colspan")) { #]','colspan="[#= items[i][headerOrder[x] + "_colspan"] #]"',"[# } #]",'[# if (items[i].hasOwnProperty(headerOrder[x] + "_rowspan")) { #]','rowspan="[#= items[i][headerOrder[x] + "_rowspan"] #]"',"[# } #]",">","[# if (edit) { #]",'[# if (inputType === "input" || (inputType === "object" && inputTypeObj[headerOrder[x]] && inputTypeObj[headerOrder[x]] === "input") ) { #]','<input class="form-control jsontable-input" type="text" data-name="[#= headerOrder[x] #]" value="[#= items[i][headerOrder[x]] #]">','[# } else if (inputType === "textarea" || (inputType === "object" && inputTypeObj[headerOrder[x]] && inputTypeObj[headerOrder[x]] === "textarea") ) { #]','<textarea class="form-control jsontable-input" data-name="[#= headerOrder[x] #]">[#= items[i][headerOrder[x]] #]</textarea>',"[# } #]","[# } else { #]",'<span class="jsontable-input-data">[#= items[i][headerOrder[x]] #]</span>',"[# if (listingTargetKey && listingTargetKey === headerOrder[x]) { #]",'<textarea class="form-control jsontable-input-hidden hidden" data-name="[#= headerOrder[x] #]">[#= items[i][headerOrder[x]] #]</textarea>',"[# } #]","[# } #]","</td>","[# } #]","</tr>","[# } #]","</tbody>"].join(""),v.tbodyLeftPlain=['<td class="[#= headerOrder #] item-[#= i #] last-child" data-item-index="[#= i #]" data-name="[#= headerOrder #]">','[# if (inputType === "input" || (inputType === "object" && inputTypeObj[headerOrder] && inputTypeObj[headerOrder] === "input") ) { #]','<input class="form-control jsontable-input" type="text" data-name="[#= headerOrder #]" value="">','[# } else if (inputType === "textarea" || (inputType === "object" && inputTypeObj[headerOrder] && inputTypeObj[headerOrder] === "textarea") ) { #]','<textarea class="form-control jsontable-input" data-name="[#= headerOrder #]"></textarea>',"[# } #]","</td>"].join(""),v.tbodyLeft=['<tbody class="jsontable-tbody">',"[# if (listingCheckbox) { #]",'<tr class="jsontable-clear-row">',"[# if (header) { #]",'<th class="mt-table-thead-th jsontable-cb-cell">&nbsp;</th>',"[# } #]","[# for (let i = 0, l = items.length; i < l; i++) { #]",'<td class="jsontable-cb-cell item-[#= i #]" data-item-index="[#= i #]">','<input type="checkbox" class="jsontable-cb">',"</td>","[# } #]","</tr>","[# } #]","[# for (let x = 0, y = headerOrder.length; x < y; x++) { #]",'<tr class="[#= headerOrder[x] #]" data-name="[#= headerOrder[x] #]">',"[# for (let i = 0, l = items.length; i < l; i++) { #]","[# if (!items[i].hasOwnProperty(headerOrder[x])) { continue; } #]",'<td class="[#= headerOrder[x] #] item-[#= i #]" data-item-index="[#= i #]" data-name="[#= headerOrder[x] #]"','[# if (items[i].hasOwnProperty(headerOrder[x] + "_colspan")) { #]','colspan="[#= items[i][headerOrder[x] + "_colspan"] #]"',"[# } #]",'[# if (items[i].hasOwnProperty(headerOrder[x] + "_rowspan")) { #]','rowspan="[#= items[i][headerOrder[x] + "_rowspan"] #]"',"[# } #]",">","[# if (edit) { #]",'[# if (inputType === "input" || (inputType === "object" && inputTypeObj[headerOrder[x]] && inputTypeObj[headerOrder[x]] === "input") ) { #]','<input class="form-control jsontable-input" type="text" data-name="[#= headerOrder[x] #]" value="[#= items[i][headerOrder[x]] #]">','[# } else if (inputType === "textarea" || (inputType === "object" && inputTypeObj[headerOrder[x]] && inputTypeObj[headerOrder[x]] === "textarea") ) { #]','<textarea class="form-control jsontable-input" data-name="[#= headerOrder[x] #]">[#= items[i][headerOrder[x]] #]</textarea>',"[# } #]","[# } else { #]",'<span class="jsontable-input-data">[#= items[i][headerOrder[x]] #]</span>',"[# if (listingTargetKey && listingTargetKey === headerOrder[x]) { #]",'<textarea class="form-control jsontable-input-hidden hidden" data-name="[#= headerOrder[x] #]">[#= items[i][headerOrder[x]] #]</textarea>',"[# } #]","[# } #]","</td>","[# } #]","</tr>","[# } #]","</tbody>"].join(""),v.buttons=['<div class="add-btn text-right">','[# if (add && headerPosition === "top") { #]','<a href="#" class="btn btn-default ml-2 jsontable-add jsontable-add-row">'+i.addRow+"</a>","[# } #]",'[# if (add && headerPosition === "left") { #]','<a href="#" class="btn btn-default ml-2 jsontable-add jsontable-add-column">'+i.addColumn+"</a>","[# } #]","[# if (cellMerge) { #]",'<a href="#" class="btn ml-2 btn-warning jsontable-cellMerge">'+i.cellMerge+"</a>","[# } #]","[# if (clear) { #]",'<a href="#" class="btn btn-danger ml-2 jsontable-clear">'+i.clearData+"</a>","[# } #]","[# if (debug) { #]",'<a href="#" class="btn ml-2 btn-success jsontable-debug">'+i.showJSON+"</a>",'<a href="#" class="btn ml-2 btn-info jsontable-check-json primary hidden">'+i.checkSyntax+"</a>","[# } #]","[# if (optionButtons) { #]","[# for (let i = 0, l = optionButtons.length; i < l; i++) { #]",'<a href="#" class="btn btn-default ml-2 [#= optionButtons[i].classname #]">[#= optionButtons[i].text #]</a>',"[# } #]","[# } #]","</div>"].join(""),v.debugMessage=['<div class="alert alert-warning jsontable-debug-message hidden">'+i.debugMessage+"</div>"].join(""),v.container=['<div class="mtapp-json-table">','<table class="table table-bordered mt-table  jsontable-table">','[# if (typeof caption === "string") { #]','[#= context.include("caption") #]',"[# } #]",'[# if (header && headerPosition === "top") { #]','[#= context.include("header") #]',"[# } #]",'[# if (header && headerPosition === "top" && footer) { #]','[#= context.include("footer") #]',"[# } #]","[# if (items.length > 0) { #]",'[# if (headerPosition === "top") { #]','[#= context.include("tbodyTop") #]','[# } else if (headerPosition === "left") { #]','[#= context.include("tbodyLeft") #]',"[# } #]","[# } #]","</table>","[# if (add || clear || optionButtons || debug) { #]",'[#= context.include("buttons") #]',"[# } #]","</div>"].join("\n"),"object"===e.type(a.inputType)&&(a.inputTypeObj=a.inputType,a.inputType="object");var y=Template.process("container",a,v);e(this).after(y);var T=n.next("div"),A=T.children("table");A.data("item-length",b),a.header&&"left"===a.headerPosition&&A.find("tr").not(".jsontable-clear-row").each((function(){var t=e(this).attr("data-name");e(this).prepend('<th class="mt-table-thead-th '+t+'" data-name="'+t+'">'+a.header[t]+"</th>")})),a.listingCheckbox&&("top"===a.headerPosition?A.on("click","input.jsontable-cb",(function(){var t=e(this).parent().parent().toggleClass("jsontable-selected-data");null!==a.cbAfterSelectRow&&"function"==typeof a.cbAfterSelectRow&&a.cbAfterSelectRow({name:"cbAfterSelectRow"},t,e(this).is(":checked"))})):"left"===a.headerPosition&&A.on("click","input.jsontable-cb",(function(){var t=e(this).parent().attr("data-item-index"),i=A.find(".item-"+t).toggleClass("jsontable-selected-data");null!==a.cbAfterSelectColumn&&"function"==typeof a.cbAfterSelectColumn&&a.cbAfterSelectColumn({name:"cbAfterSelectColumn"},i,e(this).is(":checked"))}))),(a.add||a.clear)&&T.on("click","div.add-btn a",(function(){if(e(this).hasClass("jsontable-add-row")){var t=Template.process("tbodyTopPlain",a,v);null!==a.cbBeforeAdd&&"function"==typeof a.cbBeforeAdd&&a.cbBeforeAdd({name:"cbBeforeAdd",type:"row"},T),A.find("tbody.jsontable-tbody").append(t),null!==a.cbAfterAddSystem&&"function"==typeof a.cbAfterAddSystem&&a.cbAfterAddSystem({name:"cbAfterAddSystem",type:"row"},T),null!==a.cbAfterAdd&&"function"==typeof a.cbAfterAdd&&a.cbAfterAdd({name:"cbAfterAdd",type:"row"},T)}else if(e(this).hasClass("jsontable-add-column")){var i=e.extend(!0,[],a.headerOrder);A.find("tr").each((function(){var t=e(this).children(":last-child").removeClass("last-child").clone().removeClass((function(e,t){return(t.match(/\bitem-\d+/g)||[]).join(" ")}));if(e(this).hasClass("jsontable-clear-row"))t.attr("data-item-index",b).addClass("item-"+b);else{var n={headerOrder:i.shift(),inputType:a.inputType,inputTypeObj:a.inputTypeObj,i:b};t=Template.process("tbodyLeftPlain",n,v)}null!==a.cbBeforeAdd&&"function"==typeof a.cbBeforeAdd&&a.cbBeforeAdd({name:"cbBeforeAdd",type:"column"},t),e(this).append(t)})),b++,A.data("item-length",b),null!==a.cbAfterAddSystem&&"function"==typeof a.cbAfterAddSystem&&a.cbAfterAddSystem({name:"cbAfterAddSystem",type:"column"},T),null!==a.cbAfterAdd&&"function"==typeof a.cbAfterAdd&&a.cbAfterAdd({name:"cbAfterAdd",type:"column"},T)}else e(this).hasClass("jsontable-clear")&&(null!==a.cbBeforeClear&&"function"==typeof a.cbBeforeClear&&a.cbBeforeClear({name:"cbBeforeClear"},T),A.find(".jsontable-selected-data").remove(),"left"===a.headerPosition&&(b--,A.data("item-length",b)));return!1})),a.cellMerge&&T.on("click","a.jsontable-cellMerge",(function(){e(this).toggleClass("primary");if(e(this).hasClass("primary"))A.find("td.merge-target").removeClass("merge-target"),e(this).text(i.cellMergeApply),A.on("click","td",(function(t){var a=e(this);a.parent(),a.index();a.toggleClass("merge-target"),!1}));else{e(this).text(i.cellMerge),A.off("click","td");var t=A.find("td.merge-target"),a={},n={},r={},l={},s={};a.obj=t.first(),a.idx=a.obj.index(),n.obj=a.obj.parent(),n.idx=n.obj.index(),r.obj=n.obj.children(".merge-target").last(),r.idx=r.obj.index(),l.obj=t.last(),l.idx=l.obj.index(),s.obj=l.obj.parent(),s.idx=s.obj.index();var o=n.obj.children(".merge-target").length,p=s.idx-n.idx+1,d=0;n.obj.children(".merge-target").filter("[colspan]").each((function(){d+=Number(e(this).attr("colspan"))})),d&&(o+=d-1),o>1&&a.obj.attr("colspan",o),p>1&&a.obj.attr("rowspan",p),A.find("td.merge-target").not(":first").remove()}return A.toggleClass("jsontable-cell-merge"),!1})),a.debug&&(n.before(Template.process("debugMessage",{},v)),T.on("click","a.jsontable-debug",(function(){return e(this).hasClass("showed-json")?(e(this).removeClass("showed-json").text(i.showJSON).next().addClass("hidden"),n.addClass("hidden").prev().addClass("hidden")):(e(this).addClass("showed-json").text(i.hideJSON).next().removeClass("hidden"),n.removeClass("hidden").prev().removeClass("hidden")),!1})),T.on("click","a.jsontable-check-json",(function(){try{l=JSON.parse(n.val())}catch(e){return alert(e.message),!1}return alert("Valid"),!1}))),a.edit&&(e('form[method="post"]').on("submit.MTAppJSONTable",(function(){if(n.is(":visible"))return!0;null!==a.cbBeforeSave&&"function"==typeof a.cbBeforeSave&&a.cbBeforeSave({name:"cbBeforeSave"},T,n);var t=e.fn.MTAppJSONTable.save(a.headerPosition,a.itemsRootKey,A,':not(".hidden")',a.nest);n.val(t.replace(/^(\s|\n)+$/g,"")),null!==a.cbAfterSave&&"function"==typeof a.cbAfterSave&&a.cbAfterSave({name:"cbAfterSave"},T,n,t)})),n.on("MTAppJSONTableSave",(function(){null!==a.cbBeforeSave&&"function"==typeof a.cbBeforeSave&&a.cbBeforeSave({name:"cbBeforeSave"},T,n);var t=e.fn.MTAppJSONTable.save(a.headerPosition,a.itemsRootKey,A,':not(".hidden")',a.nest);n.val(t.replace(/^(\s|\n)+$/g,"")),null!==a.cbAfterSave&&"function"==typeof a.cbAfterSave&&a.cbAfterSave({name:"cbAfterSave"},T,n,t)}))),a.sortable&&"top"===a.headerPosition&&A.sortable({items:"tr",handle:"td.jsontable-sort-handle",cursor:"move"}),null!==a.cbAfterBuildSystem&&"function"==typeof a.cbAfterBuildSystem&&a.cbAfterBuildSystem({name:"cbAfterBuildSystem"},T),null!==a.cbAfterBuild&&"function"==typeof a.cbAfterBuild&&a.cbAfterBuild({name:"cbAfterBuild"},T)}}}))},e.fn.MTAppJSONTable.save=function(t,a,i,n,r){var l="",s=[];if("string"!=typeof n&&(n=""),"top"===t)i.find("tbody.jsontable-tbody > tr"+n).each((function(){var t={};e(this).find(".jsontable-input").each((function(){var a=e(this).val();if(r){/^\s*".+?"\s*$/.test(a)&&(a=JSON.stringify(a));try{a=JSON.parse(a)}catch(e){}}t[e(this).attr("data-name")]=a,e(this).parent().attr("colspan")&&(t[e(this).attr("data-name")+"_colspan"]=e(this).parent().attr("colspan")),e(this).parent().attr("rowspan")&&(t[e(this).attr("data-name")+"_rowspan"]=e(this).parent().attr("rowspan")),l+=a})),s.push(JSON.stringify(t))}));else if("left"===t){for(var o=i.find("tr"+n),p=[],d=i.data("item-length"),c=0;c<d;c++)p.push({});o.each((function(t){e(this).find(".jsontable-input").each((function(t){var a=e(this).val();if(r){/^\s*".+?"\s*$/.test(a)&&(a=JSON.stringify(a));try{a=JSON.parse(a)}catch(e){}}var i=e(this).parent().attr("data-item-index");p[i][e(this).attr("data-name")]=a,e(this).parent().attr("colspan")&&(p[i][e(this).attr("data-name")+"_colspan"]=e(this).parent().attr("colspan")),e(this).parent().attr("rowspan")&&(p[i][e(this).attr("data-name")+"_rowspan"]=e(this).parent().attr("rowspan")),l+=a}))}));for(var u=0;u<d;u++)s.push(JSON.stringify(p[u]))}return""!==l?'{"'+a+'":['+s.join(",")+"]}":""},e.fn.MTAppListing=function(t){var a=e.extend({},e.fn.MTAppListing.defaults,t);"object"===_typeof(t.jsontable)&&null!==t.jsontable&&(a.jsontable=e.extend({},e.fn.MTAppListing.defaults.jsontable,t.jsontable));var i={};if("ja"===mtappVars.language?(i.title="項目を選択",i.search="検索",i.reset="リセット",i.ok="OK",i.cancel="キャンセル",i.select="選択",i.selectedItems="選択された項目",i.returnDialogTop="ダイアログのトップへ戻る",i.noItems="該当するデータがありません",i.ajaxFail="データを取得できませんでした"):(i.title="Select items",i.search="Search",i.reset="Reset",i.ok="OK",i.cancel="Cancel",i.select="Select",i.selectedItems="Selected items",i.returnDialogTop="Dialog top",i.noItems="A matched data was not found.",i.ajaxFail="An error occurred while getting data."),a.l10n)for(var n in a.l10n)i[n]=a.l10n[n];var r={dialog:['<div id="[#= dialog.id #]" class="modal" tabindex="-1" role="dialog">','<div class="modal-dialog modal-lg modal-dialog-centered" role="document">','<div class="modal-content">','<div class="modal-header">','<div class="modal-title">[#= dialog.title #]</div>','<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>',"</div>",'<p class="text-center mtapplisting-indicator my-6"><img src="'+StaticURI+'images/indicator.gif"></p>','<div class="modal-body hidden">','<textarea id="mtapplisting-textarea1" class="mtapplisting-dummy-textarea hidden"></textarea>','<p class="form-inline">','<input id="mtapplisting-text-filter" type="text" class="text med form-control" value="" placeholder="'+i.search+'">','<button id="mtapplisting-text-search" type="button" class="btn btn-default ml-3">'+i.search+"</button>",'<button id="mtapplisting-search-reset" type="button" class="btn btn-default search-reset ml-3">'+i.reset+"</button>","</p>",'<textarea id="mtapplisting-textarea2" class="mtapplisting-dummy-textarea hidden"></textarea>',"</div>",'<div class="modal-footer mtapplisting-actions actions-bar">','<button type="button" id="mtapplisting-dialog-ok" class="btn btn-primary ok" data-dismiss="modal" aria-label="Ok">'+i.ok+"</button>",'<button type="button" id="mtapplisting-dialog-cancel" class="btn btn-default" data-dismiss="modal" aria-label="Cancel">'+i.cancel+"</button>",'<button type="button" id="mtapplisting-dialog-top" class="btn btn-default">'+i.returnDialogTop+"</button>","</div>","</div>","</div>","</div>",""].join("")};e("#mtapplisting-dialog").length||e("body").append('<div id="mtapplisting-dialog"></div>');var l=e("#mtapplisting-dialog");return l.hasClass("bind-event")||(l.addClass("bind-event"),l.on("click","#mtapplisting-dialog-ok",(function(t){var i=e(t.delegateTarget).data("triggerId");if(!i)return!1;var n=[],r=e("#mtapplisting-tbody1"),l=r.children("tr");return l.length&&l.each((function(){n.push(e(this).find("td."+r.data("target-key")+" textarea.jsontable-input-hidden").val())})),n.length>1?e("#"+i).val(","+n.join(",")+",").trigger("change.MTAppListing"):e("#"+i).val(n[0]).trigger("change.MTAppListing"),null!==a.cbAfterOK&&"function"==typeof a.cbAfterOK&&a.cbAfterOK({name:"cbAfterOK"},e(t.delegateTarget),e("#"+i)),e(t.delegateTarget).data("triggerId",""),!1})),l.on("click","#mtapplisting-text-search",(function(t){var i=e("#mtapplisting-text-filter").val().split(/[ 　]/),n=i.length;return e("#mtapplisting-tbody2 tr").each((function(){var t,a=0,r=this.innerHTML,l=_createForOfIteratorHelper(i);try{for(l.s();!(t=l.n()).done;){var s=t.value;if(!new RegExp(s,"i").test(r)){e(this).addClass("hidden");break}a++}}catch(e){l.e(e)}finally{l.f()}a===n&&e(this).removeClass("hidden")})),null!==a.cbAfterSearch&&"function"==typeof a.cbAfterSearch&&a.cbAfterSearch({name:"cbAfterSearch"},e(t.delegateTarget)),!1})),l.on("keypress","#mtapplisting-text-filter",(function(t){13==t.which&&e(this).next().trigger("click")})),l.on("click","#mtapplisting-search-reset",(function(t){return e("#mtapplisting-text-filter").val(""),null!==a.cbAfterSearchReset&&"function"==typeof a.cbAfterSearchReset&&a.cbAfterSearchReset({name:"cbAfterSearchReset"},e(t.delegateTarget)),e("#mtapplisting-text-search").trigger("click"),!1})),l.on("click","#mtapplisting-dialog-top",(function(t){return e(t.delegateTarget).find("div.modal").animate({scrollTop:0},600,"swing"),!1}))),this.each((function(){var t=e(this),n=t.attr("id");n||(n=Math.floor(1e16*Math.random()).toString(36),t.attr("id",n));t.prev().is("label")&&t.prev().addClass("d-block w-100 mb-3"),t.parent().addClass("form-inline"),t.after('<button type="button" class="btn btn-default ml-3">'+i.select+"</button>").next("button").on("click",(function(l){var s=e("#mtapplisting-dialog").data("triggerId",n);null!==a.cbAfterOpenDialogFirst&&"function"==typeof a.cbAfterOpenDialogFirst&&a.cbAfterOpenDialogFirst({name:"cbAfterOpenDialogFirst"},s,t,e(l.target));var o={dialog:{id:n+"-modal",title:a.dialogTitle?a.dialogTitle:i.title}},p=Template.process("dialog",o,r);s.html(p).children(".modal").height(e(window).height()-110).modal();var d=s.find(".mtapplisting-indicator"),c={dataType:a.dataType,url:t.attr("data-url")?t.attr("data-url"):a.url,data:a.data,cache:a.cache};return a.accessToken&&(c.headers={"X-MT-Authorization":"MTAuth accessToken="+a.accessToken}),a.ajaxOptions&&e.extend(c,a.ajaxOptions),e.ajax(c).done((function(n){null!==a.cbProcessResponse&&"function"==typeof a.cbProcessResponse&&(n=a.cbProcessResponse({name:"cbProcessResponse"},n));var r=!0;if(null!==a.cbAjaxDoneFilterJSONTable&&"function"==typeof a.cbAjaxDoneFilterJSONTable&&(r=a.cbAjaxDoneFilterJSONTable({name:"cbAjaxDoneFilterJSONTable"},s,n)),d.addClass("hidden").next().removeClass("hidden"),!r)return s.find("div.modal-body").text(i.noItems).end().find("div.mtapplisting-actions .ok").replaceWith('<button type="button" class="btn btn-default disabled" disabled="disabled">挿入</button>').end().find("#mtapplisting-dialog-top").remove(),!1;a.jsontable.caption=i.selectedItems,a.jsontable.headerPosition="top",a.jsontable.footer=!1,a.jsontable.items=null,a.jsontable.edit=!1,a.jsontable.add=!1,a.jsontable.clear=!1,a.jsontable.cellMerge=!1,a.jsontable.sortable=!1,a.jsontable.listingCheckbox=!0,a.jsontable.listingTargetKey=a.jsontable.listingTargetKey||"id",a.jsontable.optionButtons=null,a.jsontable.cbAfterSelectRow=function(e,t,i){if("radio"===a.jsontable.listingCheckboxType)return!1;var n=!0;null!==a.cbAfterSelectRowUpperTable&&"function"==typeof a.cbAfterSelectRowUpperTable&&(n=a.cbAfterSelectRowUpperTable({name:"cbAfterSelectRowUpperTable"},t,i)),n&&(i||t.prependTo("#mtapplisting-tbody2"))},a.jsontable.cbAfterBuild=function(e,t){t.find("tbody").attr("id","mtapplisting-tbody1")},e("#mtapplisting-textarea1").MTAppJSONTable(a.jsontable),e("#mtapplisting-tbody1").data("target-key",a.jsontable.listingTargetKey).html("").sortable({items:"tr",cursor:"move",placeholder:"mtapp-state-highlight"}),a.jsontable.caption=null,a.jsontable.footer=!0,a.jsontable.items=n,a.jsontable.cbAfterSelectRow=function(t,i,n){var r=!0;null!==a.cbAfterSelectRowLowerTable&&"function"==typeof a.cbAfterSelectRowLowerTable&&(r=a.cbAfterSelectRowLowerTable({name:"cbAfterSelectRowLowerTable"},i,n)),r&&(e("#mtapplisting-textarea1").next().show(),
n&&("radio"===a.jsontable.listingCheckboxType&&e("#mtapplisting-tbody1 tr").appendTo("#mtapplisting-tbody2"),i.find("td").each((function(){var t=e(this).width();e(this).width(t+"px")})),i.appendTo("#mtapplisting-tbody1")))},a.jsontable.cbAfterBuild=function(i,n){n.find("tbody").attr("id","mtapplisting-tbody2");var r=t.val().replace(/^,|,$/g,"").split(",");if("radio"===a.jsontable.listingCheckboxType)e('td[data-value="'+r[0].replace(/\s*/g,"")+'"]').parent().find("td:first-child input.jsontable-cb").prop("checked",!0).end().appendTo("#mtapplisting-tbody1");else for(var l=0,s=r.length;l<s;l++)e('td[data-value="'+r[l].replace(/\s*/g,"")+'"]').parent().find("td:first-child input.jsontable-cb").trigger("click")},a.jsontable.debug=!1,e("#mtapplisting-textarea2").MTAppJSONTable(a.jsontable),null!==a.cbAjaxDone&&"function"==typeof a.cbAjaxDone&&a.cbAjaxDone({name:"cbAjaxDone"},s)})).fail((function(e,t){d.addClass("hidden"),e.status&&404==e.status&&s.find("div.modal-body").text(e.status+" : "+i.ajaxFail),null!==a.cbAjaxFail&&"function"==typeof a.cbAjaxFail&&a.cbAjaxFail({name:"cbAjaxFail"},s,e,t),s.find("div.mtapplisting-actions").removeClass("hidden").find("a.ok").replaceWith('<p class="action button disabled">挿入</p>').end().find("#mtapplisting-dialog-top").remove()})),null!==a.cbAfterOpenDialogLast&&"function"==typeof a.cbAfterOpenDialogLast&&a.cbAfterOpenDialogLast({name:"cbAfterOpenDialogLast"},s,t),!1}))}))},e.fn.MTAppListing.defaults={url:null,data:null,dataType:"json",cache:!1,accessToken:null,ajaxOptions:null,dialogTitle:"",l10n:null,cbAfterOpenDialogFirst:null,cbProcessResponse:null,cbAjaxDoneFilterJSONTable:null,cbAjaxDone:null,cbAjaxFail:null,cbAfterCancel:null,cbAfterOK:null,cbAfterSearch:null,cbAfterSearchReset:null,cbAfterOpenDialogLast:null,cbAfterSelectRowUpperTable:null,cbAfterSelectRowLowerTable:null,jsontable:{header:null,headerOrder:[],itemsRootKey:"items",listingTargetKey:"id",listingCheckboxType:"checkbox",listingTargetEscape:!1}},e.MTAppTemplateListCustomize=function(t){var a=e.extend({},e.MTAppTemplateListCustomize.defaults,t);"list-template"===mtappVars.screen_id&&("listIndent"===a.displayType?e("table.listing-table tbody").each((function(){for(var t=e(this).find("td.template-name"),i=function(i,n){t.find("a").filter((function(e,t){return a.templateNameSets[i].keyword instanceof RegExp?a.templateNameSets[i].keyword.test(t.innerHTML):-1!==t.innerHTML.indexOf(a.templateNameSets[i].keyword)})).each((function(t){var n=a.templateNameSets[i].replacement?a.templateNameSets[i].replacement:"";if(this.innerHTML=this.innerHTML.replace(a.templateNameSets[i].keyword,n),this.style.position="relative",this.style.left="2em",0===t){var r=(l=e(this).parents("tr")).find("td").length,o=8;e(this).parent().prevAll().each((function(){o+=e(this).width()})),l.before('<tr><td colspan="'+r+'" style="padding-left:'+o+"px;font-weight:"+a.labelWeight+';">'+a.templateNameSets[i].label+"</td></tr>")}else e(this).parents("tr").insertAfter(s);s=e(this).parents("tr")}))},n=0,r=a.templateNameSets.length;n<r;n++){var l,s;i(n)}})):e("table.listing-table tbody").each((function(){for(var t,i,n=e(this).find("td.template-name"),r=function(r,l){n.find("a").filter((function(e,t){return a.templateNameSets[r].keyword instanceof RegExp?a.templateNameSets[r].keyword.test(t.innerHTML):-1!==t.innerHTML.indexOf(a.templateNameSets[r].keyword)})).each((function(n){var l=a.templateNameSets[r].replacement?a.templateNameSets[r].replacement:"";this.innerHTML=this.innerHTML.replace(a.templateNameSets[r].keyword,l),0===n?((t=e(this).parent().prepend('<span style="display:'+a.labelType+";margin-right:5px;margin-bottom:5px;font-weight:"+a.labelWeight+';">'+a.templateNameSets[r].label+"</span>")).parent().attr("data-group-order",r),i=t.parents("tbody"),t.prevAll(".cb").find(":checkbox").remove()):e(this).closest("tr").hide().end().css({marginLeft:"5px"}).appendTo(t)}))},l=0,s=a.templateNameSets.length;l<s;l++)r(l);if(a.moveTop)for(var o=a.templateNameSets.length-1;o>=0;o--)e("[data-group-order="+o+"]").prependTo(i)})),e("tbody tr:visible").each((function(t){t%2==1?e(this).removeClass("odd even").addClass("odd"):e(this).removeClass("odd even").addClass("even")})))},e.MTAppTemplateListCustomize.defaults={templateNameSets:[],displayType:"listIndent",labelWeight:"bold",moveTop:!1,labelType:"block"},e.MTAppUserMenuWidget=function(t,a){var i=e.extend({},e.MTAppUserMenuWidget.defaults,t),n="ja"===mtappVars.language?"ja":"en",r=(a=a||{},e.extend({},e.MTAppUserMenuWidget.l10n[n],a));mtappVars.MTAppUserMenuWidget||(mtappVars.MTAppUserMenuWidget={zIndex:1e4});var l=i.label||r.widgetName,s=mtapp.temporaryId("temp-"),o=i.items,p={container:'<div id="[#= id #]" class="mtapp-usermenu-container [#= type #]" style="width:[#= width #];">[#= widget #]</div>',item:["[# if (header) { #]",'<li class="mtapp-usermenu-header">',"[# } else { #]",'<li class="mtapp-usermenu-item">',"[# } #]","[# if (url) { #]",'<a href="[#= url #]">[#= label #]</a>',"[# } else { #]",'<span class="header-label">[#= label #]</span>',"[# } #]","[# if (excerpt) { #]",'<p class="excerpt">[#= excerpt #]</p>',"[# } #]","[# if (hint) { #]",'<span class="hint">[#= hint #]</span>',"[# } #]","</li>"].join(""),menu:'<li><a id="[#= target #]-open" class="mtapp-usermenu-open" href="#[#= target #]">[#= label #]</a></li>'},d="";if(o.length>0)for(var c=0,u=o.length;c<u;c++)d+=Template.process("item",{label:o[c].label,url:o[c].url,hint:o[c].hint,header:o[c].header,excerpt:o[c].excerpt},p);var m=mtapp.makeWidget({label:l,content:"<ul>"+d+"</ul>"});if(("dashboard"===i.type||"both"===i.type)&&"dashboard"===mtappVars.screen_id){var f=Template.process("container",{type:"dashboard",id:s+"-widget",width:i.width,widget:m},p);e("#widget-container-main").prepend(f)}if("menu"===i.type||"both"===i.type){f=Template.process("container",{type:"menu",id:s,width:i.width,widget:m},p);var h=Template.process("menu",{target:s,label:l},p);e("body").prepend(f),e("#user").before(h),e("#"+s+"-open").on("click.MTAppUserMenuWidgetOpen",(function(){return mtappVars.MTAppUserMenuWidget.zIndex++,e("#"+s).css("z-index",mtappVars.MTAppUserMenuWidget.zIndex).fadeToggle("fast"),!1}))}},e.MTAppUserMenuWidget.l10n={en:{widgetName:"User Menu"},ja:{widgetName:"ユーザーメニュー"}},e.MTAppUserMenuWidget.defaults={label:"",width:"300px",type:"both",items:[]},e.fn.MTAppShowListEntries=function(t){var a=e.extend({},e.fn.MTAppShowListEntries.defaults,t);if(null!==a.api&&0!==a.siteId)return this.each((function(){a.debug||e(this).hide(),e(this).on("showListEntries",(function(){var t=e(this);t.data("api-obj",a.api);var i=t.val().replace(/^,|,$/g,""),n=i.split(","),r=t.prev(".mtapplisting-item-list");if(r.length<1){var l=['<div class="mtapplisting-item-list">','<div class="mtapplisting-item-list-content"></div>','<img class="mtapplisting-item-list-loading" src="'+StaticURI+'images/indicator-login.gif" alt="" style="display:none;">',"</div>"].join("");e(this).before(l),r=t.prev(".mtapplisting-item-list")}if(r.find(".mtapplisting-item-list-content").html(""),i){r.find(".mtapplisting-item-list-loading").show();var s="page"===a.model?"page":"entry",o={},p={ul:function(e){return"<ul>"+e+"</ul>"}};a.canEditAllPosts?p.li=function(e){return["<li>",'<span class="title">','<a href="'+CMSScriptURI+"?__mode=view&_type="+s+"&blog_id="+a.siteId+"&id="+e.id+'" target="_blank">'+e.title+"</a>","</span>",'<span class="view-link">','<a href="'+e.permalink+'" target="_blank">','<img alt="記事を見る" src="'+StaticURI+'images/status_icons/view.gif">',"</a>","</span>","</li>",""].join("")}:p.li=function(e){return["<li>",'<span class="title">'+e.title+"</span>",'<span class="view-link">','<a href="'+e.permalink+'" target="_blank">','<img alt="記事を見る" src="'+StaticURI+'images/status_icons/view.gif">',"</a>","</span>","</li>",""].join("")};var d={};for(var c in p)d[c]=[];var u=a.params||{};u.includeIds=i,"limit"in u||(u.limit=9999),"fields"in u||(u.fields="id,title,permalink");var m="page"===a.model?"listPages":"listEntries";a.api[m](a.siteId,u,(function(e){if(!e.error){if(e.items.length>0){for(var t=0,a=e.items.length;t<a;t++)e.items[t].title||(e.items[t].title="id:"+e.items[t].id),o["id-"+e.items[t].id]=e.items[t];for(var i=0,l=n.length;i<l;i++)d.li.push(p.li(o["id-"+n[i]]))}r.find(".mtapplisting-item-list-content").html(p.ul(d.li.join(""))).end().find(".mtapplisting-item-list-loading").hide()}}))}}))}))},e.fn.MTAppShowListEntries.defaults={model:"entry",api:null,siteId:0,params:null,canEditAllPosts:!0,debug:!1},e.MTAppApplyTinyMCE=function(t){var a=e.extend({},e.MTAppApplyTinyMCE.defaults,t);if("edit-entry"===mtappVars.screen_id){var i=document.getElementsByTagName("head").item(0),n=document.createElement("style"),r=document.createTextNode("[id^=customfield_] .field-content.fullscreen_editor iframe,[id^=customfield_] .field-content.fullscreen_editor textarea {height: "+(jQuery(window).height()-80)+"px !important;}");n.appendChild(r),i.appendChild(n);for(var l=a.target,s={},o={},p=0,d=l.length;p<d;p++)-1!==l[p].indexOf("customfield_")?(s[l[p]]=l[p].replace("customfield_",""),document.getElementById(l[p]).id=s[l[p]]):s[l[p]]=l[p],o[l[p]]=new MT.EditorManager(s[l[p]]);e("#entry_form").on("submit",(function(){for(var e=0,t=l.length;e<t;e++)o[l[e]].currentEditor.save()})),a.sortable&&e("#sortable").sortable({start:function(t,a){var i=a.item[0].id.replace(/-field/,"");-1!==e.inArray(i,l)&&o[i].currentEditor.save()},stop:function(t,a){var i=a.item[0].id.replace(/-field/g,"");-1!==e.inArray(i,l)&&(e("#"+s[i]).removeAttr("style").prev().remove(),o[i]=new MT.EditorManager(s[i]))}})}},e.MTAppApplyTinyMCE.defaults={target:[],sortable:!0},e.fn.MTAppMultiFileUpload=function(t){var a=e.extend({},e.fn.MTAppMultiFileUpload.defaults,t);if(null===a.api)return e.errorMessage("MTAppMultiFileUpload",'The "api" option is required.',"alert",!1);var i=a.api;if(0===a.siteId)return e.errorMessage("MTAppMultiFileUpload",'The "siteId" option is required.',"alert",!1);if("function"!=typeof i.uploadAsset)return e.errorMessage("MTAppMultiFileUpload","mt-data-api.js is required.","alert",!1);var n={};if("ja"===mtappVars.language?(n.widgetTitle="ファイルアップロード",n.remove="削除"):(n.widgetTitle="Upload File",n.remove="Remove"),a.l10n)for(var r in a.l10n)n[r]=a.l10n[r];return this.each((function(){var t=e(this),r="input"===a.type?t.val():"",l=""!==r?r.split(","):[],s=""+Math.random(),o="mtapp-multifileupload-file-"+(s=s.replace(".","")),p="mtapp-multifileupload-items-"+s,d='<a class="mtapp-item-remove" href="#">'+n.remove+"</a>";function c(r,s){if(r.error){if(401!==r.error.code||!s)return r.error.message?e.errorMessage("MTAppMultiFileUpload",r.error.message,"alert",!1):e.errorMessage("MTAppMultiFileUpload","An error occurred while authenticating.","alert",!1);location.href=i.getAuthorizationUrl(location.href)}var c=a.multiple?" multiple":"",u="";if(u=a.uploadButton?'<div class="mtapp-multifileupload-file"><input type="file" id="'+o+'"'+c+' style="display:none;">'+a.uploadButton+"</div>":'<div class="mtapp-multifileupload-file"><input type="file" id="'+o+'"'+c+"></div>",u+='<div class="mtapp-multifileupload-items" id="'+p+'" style="display:none;"></div>',"widget"===a.type){var m=mtapp.makeWidget({label:n.widgetTitle,content:u});e("#related-content").prepend(m)}else t.css(a.targetInputStyle).after(u);a.uploadButton&&e("#"+o).next().on("click",(function(){return e("#"+o).trigger("click"),!1}));var f=e("#"+p).on("click","a.mtapp-item-remove",(function(a){var i=e(a.target),n=i.prev().data("itemvalue"),r=t.val().split(",");return r=e.grep(r,(function(e,t){return e!=n})),t.val(r.join(",")),i.parent(".mtapp-upload-item").remove(),!1})),h="";if("edit-entry"===mtappVars.screen_id){var g=e("#asset-list"),b=e("#include_asset_ids");if("input"===a.type&&""!==t.val()&&g.length){for(var v=0,y=l.length;v<y;v++)if("id"===a.saveData){var T=e("#list-asset-"+l[v]);T.hasClass("asset-type-image")?h+='<p class="mtapp-upload-item"><a class="mtapp-item-type-image" href="'+CMSScriptURI+"?__mode=view&amp;_type=asset&amp;blog_id="+mtappVars.blog_id+"&amp;id="+l[v]+'" target="_blank" data-itemvalue="'+l[v]+'"><img src="'+T.find("img").attr("src")+'"></a>'+d+"</p>":T.hasClass("asset-type-file")&&(h+='<p class="mtapp-upload-item"><a class="mtapp-item-type-file" href="'+CMSScriptURI+"?__mode=view&amp;_type=asset&amp;blog_id="+mtappVars.blog_id+"&amp;id="+l[v]+'" target="_blank" data-itemvalue="'+l[v]+'">'+T.find("a.asset-title").text()+"</a>"+d+"</p>")}else"url"===a.saveData&&(/(jpg|jpeg|gif|png|bmp|ico|tif|tiff)$/i.test(l[v])?h+='<p class="mtapp-upload-item"><a class="mtapp-item-type-image" href="'+l[v]+'" target="_blank" data-itemvalue="'+l[v]+'"><img src="'+l[v]+'"></a>'+d+"</p>":h+='<p class="mtapp-upload-item"><a class="mtapp-item-type-file" href="'+l[v]+'" target="_blank" data-itemvalue="'+l[v]+'">'+l[v]+"</a>"+d+"</p>");f.html(h).show()}}e("#"+o).on("change",(function(){var n=e(this)[0],r=n.files.length;"edit-entry"===mtappVars.screen_id&&e("#empty-asset-list").remove();for(var l=!0,s=!1,o=0,p=function(i){if(o++,i.error){var n=i.error.message?": "+i.error.message:"An error occurred while uploading.";return e.errorMessage("MTAppMultiFileUpload",n,"alert",!1)}if("input"===a.type){var p=t.val();p&&a.multiple?t.val(p+","+i[a.saveData]):t.val(i[a.saveData])}var c="";if("id"===a.saveData?c=-1!==i.mimeType.indexOf("image")?'<p class="mtapp-upload-item"><a class="mtapp-item-type-image" href="'+CMSScriptURI+"?__mode=view&amp;_type=asset&amp;blog_id="+mtappVars.blog_id+"&amp;id="+i.id+'" target="_blank" data-itemvalue="'+i.id+'"><img src="'+i.url+'"></a>'+d+"</p>":'<p class="mtapp-upload-item"><a class="mtapp-item-type-file" href="'+CMSScriptURI+"?__mode=view&amp;_type=asset&amp;blog_id="+mtappVars.blog_id+"&amp;id="+i.id+'" target="_blank" data-itemvalue="'+i.id+'">'+i.filename+"</a>"+d+"</p>":"url"===a.saveData&&(c=-1!==i.mimeType.indexOf("image")?'<p class="mtapp-upload-item"><a class="mtapp-item-type-image" href="'+i.url+'" target="_blank" data-itemvalue="'+i.url+'"><img src="'+i.url+'"></a>'+d+"</p>":'<p class="mtapp-upload-item"><a class="mtapp-item-type-file" href="'+i.url+'" target="_blank" data-itemvalue="'+i.url+'">'+i.url+"</a>"+d+"</p>"),f.find("img.loading").remove(),a.multiple?f.append(c).show():f.html(c).show(),"edit-entry"===mtappVars.screen_id){var u="";u=-1!==i.mimeType.indexOf("image")?['<li id="list-asset-'+i.id+'" class="asset-type-image" onmouseover="show(\'list-image-'+i.id+"', window.parent.document)\" onmouseout=\"hide('list-image-"+i.id+"', window.parent.document)\">",'<a href="'+CMSScriptURI+"?__mode=view&amp;_type=asset&amp;blog_id="+mtappVars.blog_id+"&amp;id="+i.id+'" class="asset-title">'+i.filename+"</a>",'<a href="javascript:removeAssetFromList('+i.id+')" title="Remove this asset." class="remove-asset icon-remove icon16 action-icon">Remove</a>','<img id="list-image-'+i.id+'" src="'+i.url+'" class="list-image hidden" style="max-width:100px;">',"</li>"].join(""):['<li id="list-asset-'+i.id+'" class="asset-type-file">','<a href="'+CMSScriptURI+"?__mode=view&amp;_type=asset&amp;blog_id="+mtappVars.blog_id+"&amp;id="+i.id+'" class="asset-title">'+i.filename+"</a>",'<a href="javascript:removeAssetFromList('+i.id+')" title="Remove this asset." class="remove-asset icon-remove icon16 action-icon">Remove</a>',"</li>"].join(""),g.append(u);var m=b.val();""===m?b.val(i.id):b.val(m+","+i.id)}null!==a.cbAfterUpload&&"function"==typeof a.cbAfterUpload&&(r==o&&(s=!0),a.cbAfterUpload({name:"cbAfterUpload"},t,i,l,s)),l=!1},c=0;c<r;c++){var u=n.files[c],m={file:u,path:a.uploadPath,autoRenameIfExists:a.autoRenameIfExists,normalizeOrientation:a.normalizeOrientation};"string"==typeof a.uploadImagesPath&&-1!==u.type.indexOf("image")?m.path=a.uploadImagesPath:"string"==typeof a.uploadFilesPath&&(m.path=a.uploadFilesPath),f.append('<img class="loading" src="'+StaticURI+'images/indicator-login.gif" alt="">').show(),1==i.getVersion()?i.uploadAsset(a.siteId,m,p):(m.site_id=a.siteId,i.uploadAsset(m,p))}}))}"string"==typeof mtappVars.DataAPIFileUploadUser&&"string"==typeof mtappVars.DataAPIFileUploadUserPassword?i.authenticate({username:mtappVars.DataAPIFileUploadUser,password:mtappVars.DataAPIFileUploadUserPassword,remember:!0},(function(e){c(e)})):i.getToken((function(e){c(e,!0)}))}))},e.fn.MTAppMultiFileUpload.defaults={l10n:null,api:null,siteId:mtappVars.blog_id,autoRenameIfExists:!0,normalizeOrientation:!0,type:"input",targetInputStyle:{display:"inline",marginRight:"1em",width:"20em"},multiple:!0,saveData:"id",uploadPath:"upload",uploadImagesPath:null,uploadFilesPath:null,uploadButton:null,cbAfterUpload:null,debug:!1},e.MTAppGetCategoryName=function(t){var a=e.extend({},e.MTAppGetCategoryName.defaults,t);if("array"===e.type(a.categories)&&0!=a.id&&/^\d+$/.test(a.id))for(var i=0,n=a.categories.length;i<n;i++)if(a.categories[i].id==a.id)return a.categories[i][a.field]},e.MTAppGetCategoryName.defaults={categories:null,id:0,field:"label"},e.MTAppNoScrollRightSidebar=function(t){var a=e.extend({},e.MTAppNoScrollRightSidebar.defaults,t);if(!(e("#related-content").length<1)){var i=a.closeMode?"no-scroll-right-sidebar":"",n=e("#related-content").noScroll({right:0},"#container").addClass(i).children().addClass("widget-wrapper").find("div.widget-header");a.closeMode?(n.css({cursor:"pointer"}),""!==a.openSelector&&e(a.openSelector).find("div.widget-content").show(),n.on("click",(function(){e(this).closest("div.widget-wrapper").siblings().find("div.widget-content").slideUp().end().end().find("div.widget-content").slideToggle()}))):n.on("click",(function(){e(this).parents("div.widget-header").next().slideToggle()}))}},e.MTAppNoScrollRightSidebar.defaults={closeMode:!1,openSelector:""},e.fn.MTAppMultiForm=function(t){var a=e.extend({},e.fn.MTAppMultiForm.defaults,t);return this.each((function(t){if(a.type&&0!=a.items.length){for(var i=a.debug?e(this):e(this).hide(),n=i.val(),r=n?n.split(","):[],l=0,s=r.length;l<s;l++)r[l]=r[l].replace(/^\s+|\s+$/,"");var o=i.attr("id")?"mtappmltform-"+i.attr("id"):"";if(""==o){var p=""+Math.random();p=p.replace(".",""),o="mtappmltform-"+a.type.replace(".multiple","")+"-"+p}var d=['<span id="'+o+'" class="mtappmultiform mtappmultiform-'+a.type.replace(".","-")+'">'];switch(a.type){case"checkbox":for(var c=0,u=a.items.length;c<u;c++){var m=e.inArray(a.items[c],r)>-1?" checked":"";d.push('<label><input type="checkbox" value="'+a.items[c]+'"'+m+">"+a.items[c]+"</label>")}d.push();break;case"radio":for(var f=0,h=a.items.length;f<h;f++){m=e.inArray(a.items[f],r)>-1?" checked":"";d.push('<label><input type="radio" name="'+o+'-item" value="'+a.items[f]+'"'+m+">"+a.items[f]+"</label>")}d.push();break;case"select":d.push("<select>");for(var g=0,b=a.items.length;g<b;g++){var v=e.inArray(a.items[g],r)>-1?" selected":"";d.push('<option value="'+a.items[g]+'"'+v+">"+a.items[g]+"</option>")}d.push("</select>");break;case"select.multiple":d.push('<select multiple="multiple" style="'+a.styles+'">');for(var y=0,T=a.items.length;y<T;y++){v=e.inArray(a.items[y],r)>-1?" selected":"";d.push('<option value="'+a.items[y]+'"'+v+">"+a.items[y]+"</option>")}d.push("</select>")}d.push("</span>"),i.after(d.join(""));var A=e("#"+o);A.hasClass("mtappmultiform-radio")||A.hasClass("mtappmultiform-checkbox")?A.find("input").on("click",(function(){r=[],A.find("input:checked").each((function(){r.push(e(this).val())})),i.val(r.join(","))})):(A.hasClass("mtappmultiform-select")||A.hasClass("mtappmultiform-select-multiple"))&&A.find("select").change((function(){r=[],e(this).find("option:selected").each((function(){r.push(e(this).val())})),i.val(r.join(","))})).trigger("change")}}))},e.fn.MTAppMultiForm.defaults={debug:!1,type:"",items:[],styles:"height: auto;"},e.MTAppCustomize=function(e){return mtapp.customize(e)},e.MTAppGetLabel=function(t){for(var a=[],i=t.split(","),n=0,r=i.length;n<r;n++)l(e.trim(i[n]));function l(t){e(t).each((function(i){var n=e(this).text(),r=e(this).attr("id"),l="";if(r)l="#"+r;else if(e(this).attr("for"))l="label[for='"+e(this).attr("for")+"']";else{var s=e(this).closest("[id]").attr("id");switch(l="#"+s,s){case"entry-pref-field-list":case"metadata_fields-field":l+=" "+t+":contains('"+e.trim(n)+"')";break;default:e(l).find(t).each((function(a){e(this).text()===n&&(l+=" "+t+":eq("+a+")")}))}}a.push('["'+l+'", "'+n+'", "'+n+'"]')}))}mtapp.msg({msg:a.join(",<br>"),type:"success"})},e.MTAppCategorySwitch=function(t){var a=e.extend({selector:null,basename:null},t);if("edit-entry"===mtappVars.screen_id&&(null!==a.selector||null!==a.basename)){e("body").addClass("MTAppCategorySwitch");var i=function(e,t,a,i,n){if(a[e]=[],""!==t)for(var r=t.split(","),l=0,s=r.length;l<s;l++)if(n){var o="#"+r[l].replace(/^c:/,"customfield_")+"-field";a[e].push(o),i.push(o)}else a[e].push(r[l]),i.push(r[l])},n=[],r={};if(null!==a.selector)for(var l in a.selector)i(l,a.selector[l],r,n,!1);else if(null!==a.basename)for(var s in a.basename)i(s,a.basename[s],r,n,!0);n.sort(),e.unique(n);var o=e(n.join(",")).addClass("hidden cfs-hidden"),p=function(e){e.removeClass("hidden cfs-hidden").addClass("cfs-show").show()},d=function(){var t=e("#category-ids").val(),a=""!==t?t.split(","):["init"];""===t&&r.hasOwnProperty("init")&&r.init.length<1?p(o):o.addClass("hidden cfs-hidden");for(var i=0,n=a.length;i<n;i++){var l="init"===a[i]?"init":"cat"+a[i];if(r.hasOwnProperty(l))for(var s=0,d=r[l].length;s<d;s++)p(e(r[l][s]))}};e(document).on("click.MTAppCategorySwitch","#other-type-category-list",d),e("#category-selector").on("click.MTAppCategorySwitch",d),d()}},e.MTAppInCats=function(t){var a=e.extend({categories:"",code:function(e){}},t),i="mtappCategoryChanged."+mtapp.temporaryId(!1);if(null!==a.categories){var n;(n=a.categories.replace(/[^0-9,]/g,"").split(",")).length<1||e("#category-ids").on(i,(function(t){for(var i=""===t.target.value?[]:t.target.value.split(","),r=0;r<n.length;r++)if(-1!==e.inArray(n[r],i))return a.code(n[r]),n[r]})).trigger(i)}else e("#category-ids").on(i,(function(e){var t=""===e.target.value?[]:e.target.value.split(",");a.code(t)})).trigger(i)},e.MTAppOtherTypeCategories=function(t){var a=e.extend({type:"radio",label:"カテゴリ",notSelectedText:"未選択",selected:null,disabledExceptSelected:!1,hiddenExceptSelected:!1,add:!1,nest:!1,debug:!1},t),i={};if("ja"===mtappVars.language?(i.add="追加",i.addMessage="追加するカテゴリのラベルを入力してください"):(i.add="Add",i.addMessage="Please enter a new category's label"),a.l10n&&e.extend(i,a.l10n),"entry"===mtappVars.type||"edit-entry"===mtappVars.screen_id||"page"===mtappVars.type||"edit-page"===mtappVars.screen_id)var n=setInterval((function(){if(e("#category-selector-list div.list-item").length>0){clearInterval(n);var t=mtapp.makeWidget({label:a.label,content:'<div id="other-type-category-list"></div>',action:a.add?'<a id="other-type-category-add" href="#" class="btn btn-default pull-right">'+i.add+"</a>":""});e("#category-field").after(t),e("#other-type-category-add").on("click",(function(){var t=prompt(i.addMessage,"");return t&&(mtapp.loadingImage("show"),e.ajax({url:CMSScriptURI,data:{__mode:"js_add_category",magic_token:document.getElementById("m_t").value,blog_id:mtappVars.blog_id,parent:0,_type:"category",label:t},type:"POST"}).done((function(i){i.error&&e.errorMessage("MTAppOtherTypeCategories",i.error,"alert");var n=i.result.id;switch(a.type){case"radio":r.find("label:first").after('<div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="other-type-category" id="another-cat-'+n+'" value="'+n+'" checked="checked"><label class="form-check-label" for="another-cat-'+n+'">'+t+"</label></div>");break;case"select":r.find("option:first").after('<option value="'+n+'" selected>'+t+"</option>");break;default:return!1}e("#category-ids").val(n),mtapp.loadingImage("hide")})).fail((function(){e.errorMessage("MTAppOtherTypeCategories","Adding category failed","alert"),mtapp.loadingImage("hide")}))),!1}));var r=e("#other-type-category-list");a.debug||e("#category-field").addClass("d-none");var l=[];switch(e("#category-selector-list div.list-item").each((function(t){var i=e("#category-ids").val(),n=e(this).children().children("div"),r=n.find("label").text().replace(/\s/g,""),s=n.children("input").attr("name"),o="",p="",d="",c="",u=[],m="";if(a.nest&&(m=' style="margin-left:'+e(this).children().css("margin-left")+';"'),!s)return!0;switch(s=s.match(/[0-9]+$/)[0],a.type){case"radio":""===i?null===a.selected?o=' checked="checked"':s==a.selected?p=' checked="checked"':a.hiddenExceptSelected?c=' class="hidden"':a.disabledExceptSelected&&(d=' disabled="disabled"'):i==s?p=' checked="checked"':a.hiddenExceptSelected?c=' class="hidden"':a.disabledExceptSelected&&(d=' disabled="disabled"'),0!=t||a.selected||u.push('<div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="other-type-category" id="another-cat-0" value=""'+o+d+'><label class="form-check-label" for="another-cat-0"'+c+m+">"+a.notSelectedText+"</label></div>"),u.push('<div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="other-type-category" id="another-cat-'+s+'" value="'+s+'"'+p+d+'><label class="form-check-label" for="another-cat-'+s+'"'+c+m+">"+r+"</label></div>");break;case"select":""===i?null===a.selected?o=' selected="selected"':s==a.selected?p=' selected="selected"':a.hiddenExceptSelected?c=' class="hidden"':a.disabledExceptSelected&&(d=' disabled="disabled"'):i==s?p=' selected="selected"':a.hiddenExceptSelected?c=' class="hidden"':a.disabledExceptSelected&&(d=' disabled="disabled"'),0!=t||a.selected||u.push('<select name="other-type-category" class="form-control"><option value=""'+o+d+c+">"+a.notSelectedText+"</option>"),u.push('<option value="'+s+'"'+p+d+c+">"+r+"</option>");break;default:return!1}l.push(u.join(""))})),a.type){case"radio":r.html(l.join("")),r.on("click",'input[name="other-type-category"]',(function(){e(this).is(":checked")?e("#category-ids").val(e(this).val()):e("#category-ids").val("")})).find('input[name="other-type-category"]:checked').trigger("click");break;case"select":r.html(l.join("")+"</select>"),r.on("change","select",(function(){e("#category-ids").val(e(this).find("option:selected").val())})).find("select").trigger("change")}}}),500)},e.MTApp1clickRebuild=function(t){"list-template"==mtappVars.screen_id&&e("#index-listing, #archive-listing").each((function(){var t=e(this),a=t.find("div.listing-header h2").text(),i=t.attr("id"),n=t.find("div.button-actions:eq(0) button:eq(0)");t.find("div.button-actions").prepend('<button class="button mtapp-1click-rebuild" title="'+a+'をすべて再構築">すべて再構築</button>').find("button.mtapp-1click-rebuild").on("click",(function(){return e(this).closest("div.actions-bar").siblings("table").find("input:checkbox").prop("checked",!0),n.trigger("click"),!1})),t.find("#"+i+"-table").find("th.cb").insertListingColum("after","th","再構築","rebuild").end().find("tbody").find("td.cb").insertListingColum("after","td",'<img class="mtapp-rebuild-icon" src="'+mtappVars.static_plugin_path+'images/rebuild.png" width="13" height="13" />',"rebuild").end().find("img.mtapp-rebuild-icon").each((function(){var t=e(this).closest("td").next().find("a").text();e(this).attr("title",t+" を再構築する")})).on("click",(function(){return e(this).closest("td.rebuild").prev("td.cb").find("input:checkbox").prop("checked",!0),n.trigger("click"),!1}))}))},e.MTAppCreateLink=function(t){var a=e.extend({},e.MTAppCreateLink.defaults,t),i=CMSScriptURI;switch(a.title){case"ユーザーダッシュボード":return i+"?__mode=dashboard";case"ダッシュボード":return i+"?__mode=dashboard&blog_id="+a.blog_id;default:return""}},e.MTAppCreateLink.defaults={title:"",blog_id:0,id:0},e.MTAppHasCategory=function(t){var a=e.extend({requiredIds:"",requiredCount:0,idErrorTitle:"エラー",idErrorContent:"必須カテゴリが選択されていません。",countErrorTitle:"エラー",countErrorContent:"必要な数のカテゴリが選択されていません。"},t),i=e("form#entry_form");if(!(i.length<1)){var n=mtappVars.type;if("entry"==n||"page"==n){var r=a.requiredIds?a.requiredIds.split(","):[],l={modal:!0,callbacks:[{type:"hide.bs.modal",action:function(){e("button.btn-primary:disabled").prop("disabled",!1),i.removeAttr("mt:once")}}]};i.on("submit.MTAppHasCategory",(function(){for(var t=!1,i=e(this).serializeArray(),n=0,s=i.length;n<s;n++)if("__mode"===i[n].name&&"preview_entry"===i[n].value){t=!0;break}t||(delete Editor.strings.unsavedChanges,e(window).off("beforeunload"));var o=e("input[name='category_ids']").val()?e("input[name='category_ids']").val().split(","):[];if(r.length)for(var p=0,d=r.length;p<d;p++)if(-1==e.inArray(r[p],o))return l.title=a.idErrorTitle,l.content=a.idErrorContent,mtapp.modalMsg(l),!1;return a.requiredCount&&a.requiredCount>o.length?(l.title=a.countErrorTitle,l.content=a.countErrorContent,mtapp.modalMsg(l),!1):(t||(void 0!==window.indirectObjects&&delete window.indirectObjects,e(this).find("button.primary").prop("disabled",!0)),!0)}))}}},e.MTAppSortableBatchEdit=function(t){var a=e.extend({target:"created_on",interval:"day",targetSort:!0,update:null},t);if(-1!==mtappVars.screen_id.indexOf("batch-edit-")){var i={year:321408e5,month:26784e5,day:864e5,hour:36e5,minute:6e4,second:1e3};void 0!==a.interval&&0!=i.hasOwnProperty(a.interval)||(a.interval="day");if(1==a.targetSort&&"modified_on"===a.target){var n=[];e("#"+mtappVars.screen_id.replace(/batch-edit-/,"")+"-listing-table tbody tr").each((function(){var t=e(this).find("td.datetime:eq(1) input:text").val().replace(/ /,"T"),a=new Date(t).getTime();n.push({ts:a,html:this.outerHTML})})),e.objectSort(n,"ts","descend","numeric");for(var r="",l=0,s=n.length;l<s;l++)r+=n[l].html;e("#"+mtappVars.screen_id.replace(/batch-edit-/,"")+"-listing-table tbody").get(0).innerHTML=r}e("#"+mtappVars.screen_id.replace(/batch-edit-/,"")+"-listing-table").find("tr").css({cursor:"move"}).end().find("tbody").sortable({items:"tr",cursor:"move",placeholder:"mtapp-state-highlight",start:function(t,a){e(a.placeholder).height(e(a.item).height()).css("background-color","#FFFBE6")},sort:function(e,t){t.item.css({"background-color":"#F6F1E1",border:"1px solid #CACACA"})},stop:function(e,t){t.item.css({"background-color":"inherit",border:"none"})},update:function(t,n){if("function"==typeof a.update)a.update(t,n);else if("created_on"==a.target||"modified_on"==a.target){var r="created_on"==a.target?0:1,l=(new Date).getTime();e("#"+mtappVars.type+"-listing-table tbody tr").each((function(t){var n=l-(t+1)*(i[a.interval]-0);e(this).find("td.datetime:eq("+r+") input:text").val(function(e,t){var a=new Date(e);return a.getFullYear()+"-"+mtapp.zeroPad(a.getMonth()+1,2)+"-"+mtapp.zeroPad(a.getDate(),2)+" "+("day"===t?"00":mtapp.zeroPad(a.getHours(),2))+":"+("day"===t||"hour"===t?"00":mtapp.zeroPad(a.getMinutes(),2))+":"+("day"===t||"hour"===t||"minute"===t?"00":mtapp.zeroPad(a.getSeconds(),2))}(n,a.interval))}))}}})}},e.MTAppBatchEditCategory=function(t){var a=e.extend({text:"をまとめて変更"},t);if(!(mtappVars.screen_id.indexOf("batch-edit-")<0)){var i="batch-edit-entry"==mtappVars.screen_id?"カテゴリ"+a.text:"フォルダ"+a.text,n=e("td.category").find("select"),r=n.eq(0).clone().attr("id","mtapp_clone_select").addClass("ml-3"),l=e('<button class="btn btn-default ml-3" title="'+i+'">'+i+"</button>").on("click",(function(){var t=e("#mtapp_clone_select").val();return n.each((function(){e(this).val(t)})),!1}));e("#actions-bar-top").find("button.primary").after(l).after(r)}},e.fn.MTAppAssetsGallery=function(t,a){var i=e.extend({},e.fn.MTAppAssetsGallery.defaults,t),n="ja"===mtappVars.language?"ja":"en",r=(a=a||{},e.extend({},e.fn.MTAppAssetsGallery.l10n[n],a)),l={assetType:i.galleryType,assetTypeLabel:i.galleryLabel||"",noConvert:!1,debug:i.debug},s={inputType:"textarea",caption:null,header:null,headerOrder:[],headerPosition:"top",footer:!1,items:null,itemsRootKey:"items",edit:!0,add:!0,clear:!0,cellMerge:!1,sortable:!0,optionButtons:null,cbAfterBuildSystem:function(e,t){t.find("td.asset textarea").not(".isMTAppAssetFields").MTAppAssetFields(l)},cbBeforeAdd:null,cbAfterAddSystem:function(e,t){t.find("td.asset textarea").not(".isMTAppAssetFields").MTAppAssetFields(l)},
cbBeforeClear:null,cbAfterSelectRow:null,cbAfterSelectColumn:null,cbBeforeSave:null,cbAfterSave:null,nest:!0,debug:i.debug},o=e.extend({},s,i.MTAppJSONTableOptions);return this.each((function(){var t=e(this);t.before('<div class="MTAppAssetsGallery"><textarea class="text full low"></textarea></div>');var a=t.prevAll(".MTAppAssetsGallery").eq(0),n=a.find("textarea");return n.MTAppAssetFields({assetType:i.galleryType,assetTypeLabel:i.galleryLabel,edit:!1,noConvert:!1,canMulti:!0,debug:i.debug},{select:r.select}),n.on("MTAppDialogClosed",(function(){if(""===e(this).val())return!1;mtapp.loadingImage("show");var a=e(this).val();(a=a.split("<form")).shift();for(var i=0,n=a.length;i<n;i++)a[i]="<form"+a[i];for(var r=t.next("div.mtapp-json-table"),l=r.find("td.asset textarea.jsontable-input").filter((function(){return""===e(this).val()})),s=r.find("a.jsontable-add-row"),o=a.length-l.length,p=0;p<o;p++)s.trigger("click");(l=r.find("td.asset textarea.jsontable-input").filter((function(){return""===e(this).val()}))).each((function(){var t=a.shift();e(this).val(t).trigger("convert").trigger("refreshHTML",["force"])})),mtapp.loadingImage("hide")})),a.find("a.mtapp-open-dialog").on("click.MTAppAssetsGalleryMultiUpload",(function(){mtappVars.MTAppObsDialog.callbackTargetSelector="#"+n.attr("id"),mtappVars.MTAppObsDialog.obs()})),t.MTAppJSONTable(o),!0}))},e.fn.MTAppAssetsGallery.l10n={en:{select:" Bulk Select"},ja:{select:"を一括選択"}},e.fn.MTAppAssetsGallery.defaults={galleryType:"image",galleryLabel:"",MTAppJSONTableOptions:{},debug:!1},e.MTAppGroupFilter=function(t){/group$/.test(mtappVars.screen_id)&&0!=e("#filter-select").length&&(e("#filter-select").append('<input type="search" value="" id="mtapp-group-filter" placeholder="filter...">'),e("#mtapp-group-filter").on("keyup",(function(){var t=new RegExp(e(this).val(),"i");e("#item-left div.object-listing-content li > span").each((function(){t.test(e(this).text())?e(this).parent().removeClass("hidden"):e(this).parent().addClass("hidden")}))})))},e.MTAppGoogleMapFields=function(t){var a=e.extend({},e.MTAppGoogleMapFields.defaults,t);if("edit-entry"===mtappVars.screen_id&&null!==a.basename){var i=a.custom?"customfield_"+a.basename:a.basename,n=e("#"+i),r=e("#"+i+"-field");r.after('<div id="'+i+'_gmap"></div>'),n.hide();var l,s,o,p,d,c=n.val(),u=""!==c?c.split(","):a.mapPosition,m=parseFloat(u[0]),f=parseFloat(u[1]),h=parseInt(u[2]),g=e("#"+i+"_gmap"),b={zoom:h,center:new google.maps.LatLng(m,f),mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1,zoomControl:!0,disableDefaultUI:!0},v=function(){l=new google.maps.Marker({position:s.getCenter(),map:s})};g.css({width:a.mapWidth,height:a.mapHeight,marginBottom:"15px"}),r.css({marginBottom:0}),s=new google.maps.Map(g[0],b),v(),google.maps.event.addListener(s,"center_changed",(function(){l.setMap(null),v()})),google.maps.event.addListener(s,"idle",(function(){var e,t;e=s.getCenter(),t=[e.lat(),e.lng(),s.getZoom()],n.val(t.join(","))})),null!==a.address&&(o=new google.maps.Geocoder,p=e(a.address).closest(".field").find(".field-header > label").text(),(d=n.closest(".field").find(".field-header")).append('<a href="#" class="button update-map">「'+p+"」から地図を表示</a>"),d.find(".update-map").on("click",(function(t){t.preventDefault();var i=e(a.address).val();o&&o.geocode({address:i},(function(e,t){t==google.maps.GeocoderStatus.OK?(s.setCenter(e[0].geometry.location),l.setPosition(e[0].geometry.location)):t==google.maps.GeocoderStatus.ERROR?alert("サーバとの通信時に何らかのエラーが発生しました。"):t==google.maps.GeocoderStatus.INVALID_REQUEST?alert("GeocoderRequestに誤りがあります。"):t==google.maps.GeocoderStatus.OVER_QUERY_LIMIT?alert("クエリ送信の制限回数を超えました。時間を空けて検索してください。"):t==google.maps.GeocoderStatus.REQUEST_DENIED?alert("ジオコーダの利用が許可されていません。"):t==google.maps.GeocoderStatus.UNKNOWN_ERROR?alert("未知のエラーに遭遇しました。"):t==google.maps.GeocoderStatus.ZERO_RESULTS?alert("検索結果が見つかりませんでした。キーワードを変えて検索してください。"):alert(t)}))}))),a.debug&&n.show()}},e.MTAppGoogleMapFields.defaults={basename:null,custom:null,address:null,debug:!1,mapPosition:[35.68118333426901,139.76734411475218,14],mapWidth:"100%",mapHeight:"400px"},e.fn.extend({insertListingColum:function(t,a,i,n){return this.each((function(){var r="";n=n?" "+n:"","th"==a?r='<th class="col head'+n+'"><span class="col-label">'+i+"</span></th>":"td"==a&&(r='<td class="col'+n+'">'+i+"</td>"),e(this)[t](r)}))}}),e.extend({digit:function(e,t){var a=t?" ":"0";return(e+="").length<2?a+e:e},zeroPad:function(e,t){for(e=e.toString();e.length<t;)e="0"+e;return e},toInt:function(e,t){return e=(e+="").replace(/０/g,"0").replace(/１/g,"1").replace(/２/g,"2").replace(/３/g,"3").replace(/４/g,"4").replace(/５/g,"5").replace(/６/g,"6").replace(/７/g,"7").replace(/８/g,"8").replace(/９/g,"9"),t||(e=e.replace(/\D/g,"")),e},errorMessage:function(e,t,a,i){a||(a=null);var n="You have an error in "+e+": "+t;switch(a){case"alert":alert(n);break;case"console":this.console&&void 0!==console.log&&console.log(n)}return"boolean"==typeof i?i:n},objectSort:function(e,t,a,i){a="ascend"===a?-1:1,e.sort((function(e,n){var r=e[t],l=n[t];return"numeric"===i?(r-=0,l-=0):"string"===i&&(r=""+r,l=""+l),r<l?1*a:r>l?-1*a:0}))}}),e.fn.MTAppLineBreakField=function(t){console.warn("MTAppLineBreakField は非推奨です。今後のバージョンで削除される予定です。");var a=e.extend({inputClass:"text full",sortable:!0},t),i=a.inputClass?a.inputClass:a.input_class,n=a.sortable;return this.each((function(){for(var t=e(this).hide(),a=(t.attr("id"),t.val().split("\n")),r=t.parent(),l=[],s=0,o=a.length;s<o;s++)l.push(p(a[s]));function p(e){return['<span class="mtapp-linebreak-field-item form-inline">','<span class="mtapp-linebreak-field-item-inner">','<input type="text" class="form-control mtapp-linebreak-field-input '+i+'" value="'+e+'" />','<img class="mtapp-linebreak-field-add" src="'+mtappVars.static_plugin_path+'images/plus-circle.png" alt="plus" />',"</span>","</span>"].join("")}t.after(l.join("")),r.on("click","img.mtapp-linebreak-field-add",(function(){e(this).parent().parent().after(p("")).next().children().children().trigger("focus")})),r.on("blur","input.mtapp-linebreak-field-input",(function(){var a=[],i=r.find("input.mtapp-linebreak-field-input"),n=i.length;i.each((function(){""!=e(this).val()?a.push(e(this).val()):n>1&&e(this).parent().parent().remove()})),t.val(a.join("\n"))})),r.on("keydown","input.mtapp-linebreak-field-input",(function(t){if(13==(t.which||t.keyCode))return e(this).trigger("blur").next().trigger("click"),!1})),n&&r.addClass("mtapp-sortable").sortable({update:function(t,a){e(a.item).find("input").trigger("blur")}})}))},e.fn.MTAppCheckCategoryCount=function(){return this.each((function(){MTAppRemovedMessage("MTAppCheckCategoryCount","v2.3.5","$.MTAppHasCategory() をご利用ください。")}))},e.fn.MTAppDynamicSelect=function(){return this.each((function(){MTAppRemovedMessage("MTAppDynamicSelect","v2.0.0",".mtapp('dynamicSelect', options) をご利用ください。")}))},e.fn.MTAppSuggest=function(){return this.each((function(){MTAppRemovedMessage("MTAppSuggest","v2.0.0",".mtapp('suggest', options) をご利用ください。")}))},e.fn.MTAppMaxLength=function(){return this.each((function(){MTAppRemovedMessage("MTAppMaxLength","v2.0.0",".mtapp('maxLength', options) をご利用ください。")}))},e.fn.MTAppTaxAssist=function(){return this.each((function(){MTAppRemovedMessage("MTAppTaxAssist","v2.0.0",".mtapp('taxAssist', options) をご利用ください。")}))},e.fn.MTAppNumChecker=function(){return this.each((function(){MTAppRemovedMessage("MTAppNumChecker","v2.0.0",".mtapp('numChecker', options) をご利用ください。")}))},e.fn.MTAppDateAssist=function(){return this.each((function(){MTAppRemovedMessage("MTAppDateAssist","v2.0.0",".mtapp('dateAssist', options) をご利用ください。なお、 `gengo` オプションは廃止されました。")}))},e.fn.MTAppInlineEdit=function(){return this.each((function(){MTAppRemovedMessage("MTAppInlineEdit","v2.0.0",".mtapp('inlineEdit', options) をご利用ください。")}))},e.fn.MTAppshowHint=function(){return this.each((function(){MTAppRemovedMessage("MTAppshowHint","v2.0.0",".mtapp('showHint', options) をご利用ください。")}))},e.fn.MTAppRemoveVal=function(){return this.each((function(){MTAppRemovedMessage("MTAppRemoveVal","v2.0.0",".mtapp('removeVal') をご利用ください。")}))},e.fn.MTAppTabSpace=function(){return this.each((function(){MTAppRemovedMessage("MTAppTabSpace","v2.0.0",".mtapp('tabToSpace', options) をご利用ください。")}))},e.fn.MTAppFancyListing=function(){return this.each((function(){MTAppRemovedMessage("MTAppFancyListing","v2.0.0","MTAppListing をご利用ください。")}))},e.fn.MTAppTooltip=function(){return this.each((function(){MTAppRemovedMessage("MTAppTooltip","v2.0.0",".mtapp('tooltip', options) をご利用ください。")}))},e.fn.MTAppFieldSplit=function(){return this.each((function(){MTAppRemovedMessage("MTAppFieldSplit","v2.0.0",".mtapp('fieldSplit', options) をご利用ください。")}))},e.fn.multicheckbox=function(){return this.each((function(){MTAppRemovedMessage("multicheckbox","v2.0.0",".mtapp('multiCheckbox', options) をご利用ください。")}))},e.MTAppSetLabel=function(){MTAppRemovedMessage("MTAppSetLabel","v2.0.0","")},e.MTAppTabs=function(){MTAppRemovedMessage("MTAppTabs","v2.0.0","mtapp.tabs() をご利用ください。オプションの指定方法が変更されました。ドキュメントをご確認ください。")},e.MTAppMultiCheckbox=function(){MTAppRemovedMessage("MTAppMultiCheckbox","v2.0.0",".mtapp('multiCheckbox', options) をご利用ください。")},e.varType=function(){MTAppRemovedMessage("varType","v2.0.0","$.type() をご利用ください。")},e.MTAppSlideMenu=function(){MTAppRemovedMessage("MTAppSlideMenu","v2.0.0","")},e.MTAppSlideMenuV2=function(){MTAppRemovedMessage("MTAppSlideMenuV2","v2.0.0","")},e.MTAppMoveToWidget=function(){MTAppRemovedMessage("MTAppMoveToWidget","v2.0.0","mtapp.moveToWidget() をご利用ください。")},e.MTAppKeyboardShortcut=function(){MTAppRemovedMessage("MTAppKeyboardShortcut","v2.0.0","")},e.MTAppFieldSort=function(){MTAppRemovedMessage("MTAppFieldSort","v2.0.0","mtapp.fieldSort() をご利用ください。")},e.MTAppLoadingImage=function(){MTAppRemovedMessage("MTAppLoadingImage","v2.0.0","mtapp.loadingImage() をご利用ください。")},e.MTAppDebug=function(){MTAppRemovedMessage("MTAppDebug","v2.0.0","mtapp.debug() をご利用ください。")},e.MTAppDialogMsg=function(){MTAppRemovedMessage("MTAppDialogMsg","v2.0.0","mtapp.modalMsg() をご利用ください。")},e.MTAppDuplicate=function(){MTAppRemovedMessage("MTAppDuplicate","v2.0.0","mtapp.duplicate() をご利用ください。")},e.MTAppMakeWidget=function(){MTAppRemovedMessage("MTAppMakeWidget","v2.0.0","mtapp.makeWidget() をご利用ください。")},e.MTAppMakeField=function(){MTAppRemovedMessage("MTAppMakeField","v2.0.0","mtapp.makeField() をご利用ください。")},e.MTAppMsg=function(){MTAppRemovedMessage("MTAppMsg","v2.0.0","mtapp.msg() をご利用ください。")},e.MTAppRemoveVal=function(){MTAppRemovedMessage("MTAppRemoveVal","v2.0.0",".mtapp('removeVal') をご利用ください。")},e.MTAppFullscreen=function(){MTAppRemovedMessage("MTAppFullscreen","v2.0.0","エディタの全画面表示をご利用ください。")},e.temporaryId=function(){MTAppRemovedMessage("temporaryId","v2.0.0","mtapp.temporaryId() をご利用ください。")},e.numberFormat=function(){MTAppRemovedMessage("numberFormat","v2.0.0","mtapp.numberFormat() をご利用ください。")}}}(jQuery);