/*!
 * MTAppjQuery.js
 *
 * Copyright (c) bit part LLC
 * https://bit-part/
 *
 * Since:   2010/06/22
 * Version: 2.5.1
 * Update:  2020/08/28
 *
 */
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}if("object"!==("undefined"==typeof mtappVars?"undefined":_typeof(mtappVars))){var fatalErrorMessage='Fatal error occurred in MTAppjQuery: "mtappVars" is required.';alert(fatalErrorMessage)}if(void 0!==mtappVars.DataAPI){var updateToken=function(){mtappVars.DataAPI.getToken((function(e){e.error&&console.warn(e.error)}))};updateToken(),setInterval(updateToken,mtappVars.accessTokenTTL/2*1e3)}var BP=function(){};!function(e,t,a,i){BP.prototype={snippet:{if_this_screen:function(){return"if (mtappVars.screen_id === '"+i.screen_id+"') {}"},if_this_screen_and_content_type:function(){return"if (mtappVars.screen_id === '"+i.screen_id+"' && mtappVars.content_type_id === "+i.content_type_id+") {}"},if_this_content_data:function(){return"if (mtappVars.screen_id === '"+i.screen_id+"' && mtappVars.id === "+i.id+") {}"}},condition:function(e,t){for(var a in e)if(-1!==a.indexOf(".")){for(var n=a.split(/\./),o=void 0,l=0,s=n.length;l<s;l++)if(void 0===(o=0===l?i[n[l]]:o[n[l]]))return;if(o!=e[a])return}else if(void 0===i[a]||i[a]!=e[a])return;"function"==typeof t&&t()},columnGroup:function(t){var a=e.extend({group:[],selector:"",type:"card",method:"after",changeFormat:!1},t);if(!("view"!==i.mode&&"content_data"!==i.type||"after"!==a.method&&"before"!==a.method&&"insertAfter"!==a.method&&"insertBefore"!==a.method&&"prepend"!==a.method&&"append"!==a.method)){var n=e(a.selector);void 0===i.contentDataFields&&this.getContentDataFields(),"before"!==a.method&&"append"!==a.method&&a.group.reverse();for(var o=0,l=a.group.length;o<l;o++){var s=this.temporaryId(),r="mtapp-column-group-"+a.group[o].key,d=a.group[o].label,p=a.group[o].fields;n[a.method]('<div id="'+s+'"></div>'),"after"===a.method?n.addClass("mb-6"):"before"===a.method&&n.addClass("mt-6"),new Vue({el:"#"+s,template:"#mtapp-column-group-"+a.type+"-tmpl",data:{groupKey:r,groupLabel:d}});for(var c=e("#"+r+" div.row"),m=0,u=p.length;m<u;m++)if(i.contentDataFields["contentField"+p[m].id]){!1===a.changeFormat&&i.contentDataFields["contentField"+p[m].id].find("select.convert_breaks").parent().hide().parent().removeClass("mt-contentblock");var f=e('<div class="mtapp-group-column '+p[m].column+'"></div>').append(i.contentDataFields["contentField"+p[m].id]);c.append(f)}}}},getContentDataFields:function(){"view"!==i.mode&&"content_data"!==i.type||(i.contentDataFields={},e("#content_data > div.form-group").each((function(){var t=e(this),a=0,n=t.find("[name^=content-field-]").first().attr("name");n&&(a=n.match(/content-field-(\d+).*/)[1]),0===a&&(n=t.find("[name^=date-]").first().attr("name"))&&(a=n.match(/date-(\d+).*/)[1]),0===a&&(n=t.find("[name^=time-]").first().attr("name"))&&(a=n.match(/time-(\d+).*/)[1]),0===a&&(n=t.find("[name^=category-]").first().attr("name"))&&(a=n.match(/category-(\d+).*/)[1]),0===a&&(n=t.find("[id^=asset-field-]").first().attr("id"))&&(a=n.match(/asset-field-(\d+).*/)[1]),0===a&&(n=t.find("[id^=content-type-field-]").first().attr("id"))&&(a=n.match(/content-type-field-(\d+).*/)[1]),0!==a?(i.contentDataFields["contentField"+a]=t,t.attr("id")?t.addClass("contentField"+a):t.attr("id","contentField"+a)):t.is("#data_label-field")&&(i.contentDataFields.dataLabelField=t)})))},columnGroupSettingUI:function(){if("view"===i.mode||"content_type"===i.type){e("div.mt-mainContent--scrollable").append('<div id="mtapp-column-group-setting-wrapper"></div>');new Vue({el:"#mtapp-column-group-setting-wrapper",template:"#mtapp-column-group-setting-tmpl",data:{settingJson:"",exportedFields:"",importedFields:"",importedContentTypeName:"",destinationGroup:"",movingFieldsId:[],visible:!1,visibleExportFields:!1,visibleImportFields:!1,visibleMoveToListButton:!1,visibleError:!1,contentFields:null,contentFieldsGroups:[]},methods:{cloneFields:function(){this.visible=!this.visible;for(var e=JSON.parse(t.fields.toJSON()),a=0,i=e.length;a<i;a++)e[a].group="",e[a].column=" col-md-12 col-lg-6",e[a].isActive="";this.contentFields=e},addGroup:function(){this.contentFieldsGroups.push({label:"グループ名",key:"group"+(this.contentFieldsGroups.length+1),fields:[]})},setMovingFieldsId:function(e,t){t-=0,this.movingFieldsId.push(t),this.contentFields[e].isActive=!this.contentFields[e].isActive},moveFields:function(){if(this.destinationGroup){for(var e=0,t=this.contentFields.length;e<t;e++){var a=this.contentFields[e].id-0;-1!==this.movingFieldsId.indexOf(a)&&(this.contentFields[e].group=""+this.destinationGroup)}this.movingFieldsId=[]}},isGroupField:function(e,t){return e===t},removeField:function(e){this.contentFields[e].group="",this.contentFields[e].isActive=!1},printSetting:function(){for(var e=0,t=this.contentFieldsGroups.length;e<t;e++){var a=this.contentFieldsGroups[e].key;this.contentFieldsGroups[e].fields=[];for(var i=0,n=this.contentFields.length;i<n;i++)this.contentFields[i].group===a&&this.contentFieldsGroups[e].fields.push({id:this.contentFields[i].id,column:this.contentFields[i].column})}this.settingJson=this.contentFieldsGroups.toJSON()},restoreSetting:function(){this.contentFieldsGroups=JSON.parse(this.settingJson);for(var e=0;e<this.contentFieldsGroups.length;e++)for(var t=this.contentFieldsGroups[e].fields,a=this.contentFieldsGroups[e].key,i=0;i<this.contentFields.length;i++)for(var n=this.contentFields[i].id-0,o=0;o<t.length;o++)n===t[o].id-0&&(this.contentFields[i].group=a,this.contentFields[i].column=t[o].column)},exportFields:function(){this.visibleExportFields=!this.visibleExportFields;for(var e=JSON.parse(t.fields.toJSON()),a=0,i=e.length;a<i;a++){for(var n in e[a])"order"!==n&&"type"!==n&&"options"!==n&&delete e[a][n];e[a].options.id="id:"+Math.random().toString(36).slice(-8)}this.exportedFields=JSON.stringify(e)},importFields:function(){this.visibleImportFields=!this.visibleImportFields},visibleImportButton:function(){return""!==this.importedContentTypeName},execImport:function(){var t=this;e.ajax({url:location.href.replace(/\?.*/g,""),method:"post",data:{__mode:"save",blog_id:i.blog_id,magic_token:a.querySelector('[name="magic_token"]').value,return_args:"__mode=view&_type=content_type&blog_id="+i.blog_id,_type:"content_type",id:"",data:t.importedFields,name:t.importedContentTypeName,description:"",label_field:"",user_disp_option:"on"}}).done((function(){t.visibleMoveToListButton=!0})).fail((function(){t.visibleError=!0}))},moveToList:function(){location.href=location.href.replace(/\?.*/g,"?__mode=list&_type=content_type&blog_id="+i.blog_id)}}})}},multiField:function(t){var n=e.extend({},{getType:function(e){if(-1!==["text","email","url","tel","password","number","datepicker","date","time","h1","h2","h3","h4","h5","h6"].indexOf(e))return"text"},up:function(e){var t=this.items;t[e].updated?t[e].updated++:t[e].updated=1,t[e-1].updated?t[e-1].updated++:t[e-1].updated=1,t.splice(e-1,2,t[e],t[e-1])},down:function(e){var t=this.items;t[e].updated?t[e].updated++:t[e].updated=1,t[e+1].updated?t[e+1].updated++:t[e+1].updated=1,t.splice(e,2,t[e+1],t[e])},insert:function(t){var a=this;Vue.set(a,"insertPoint",t),e("#mtapp-mf-modal-"+a.id).modal().on("hidden.bs.modal",(function(){Vue.set(a,"insertPoint",-1)}))},insertAbove:function(){Vue.set(this,"insertPointDirection",0)},insertBelow:function(){Vue.set(this,"insertPointDirection",1)},remove:function(e){var t=this;mtapp.modalConfirm({type:"warning",content:"削除しますか？",callback:function(){t.items.splice(e,1)}})},add:function(e){if(this.maxBlocks&&this.maxBlocks<=this.items.length)mtapp.modalMsg({type:this.maxBlocksMessage.type,title:this.maxBlocksMessage.title,content:this.maxBlocksMessage.content.replace(/%maxblocks/gi,this.maxBlocks)});else{var t=JSON.parse(Object.toJSON(e));t.id=mtapp.temporaryId();var a=t.data?t.data:"";if("table"===e.type)for(var i=0,n=(a=JSON.parse("["+Object.toJSON(e.options)+"]")).length;i<n;i++)for(var o=0,l=a[i].length;o<l;o++)a[i][o].id=mtapp.temporaryId();else if("multi-column"===e.type||"table-vertical-fixed"===e.type)for(var s=0,r=(a=JSON.parse(Object.toJSON(e.options))).length;s<r;s++)a[s].id=mtapp.temporaryId();else if("multi-column-content"===e.type){a=JSON.parse(Object.toJSON(e.options));for(var d=0;d<a.length;d++)for(var p=0;p<a[d].length;p++)a[d][p].id=mtapp.temporaryId()}else"listing"===e.type&&(a=[]);t.data=a,this.addType=e.type,-1!==this.insertPoint?this.items.splice(this.insertPoint+this.insertPointDirection,0,t):this.items.push(t),this.insertPoint=-1}},radioName:function(e){return void 0===e.id&&(e.id=mtapp.temporaryId()),e.id},tableRowUp:function(e,t){var a=this.items[e].data;a.splice(t-1,2,a[t],a[t-1])},tableRowDown:function(e,t){var a=this.items[e].data;a.splice(t,2,a[t+1],a[t])},tableRowRemove:function(e,t){var a=this;mtapp.modalConfirm({type:"warning",content:"削除しますか？",callback:function(){a.items[e].data.splice(t,1)}})},tableRowAdd:function(e){for(var t=JSON.parse(Object.toJSON(this.items[e].options)),a=0;a<t.length;a++)t[a].id=mtapp.temporaryId();this.items[e].data.push(t)},textInput:function(e){},vueContentDataSaved:function(e){},vueListContentData:function(e){}},t.methods);delete t.methods;var o=t.watch?e.extend({},t.watch):null;delete t.watch;var l=e.extend({debug:!1,addType:"",showAddContainer:!1,showAddFieldButton:!0,showViewRawDataButton:!1,showSortButton:!0,showInsertButton:!0,showRemoveButton:!0,addFieldButtonLabel:"フィールドを追加",insertPoint:-1,insertPointDirection:0,items:[],minBlocks:0,maxBlocks:0,maxBlocksType:"",maxBlocksMessage:{type:"warning",title:"お知らせ",content:'<p class="mb-0"><strong>最大ブロック数は %maxblocks です。</strong></p>'},fieldGroups:[[{type:"h1",label:"見出し H1"},{type:"h2",label:"見出し H2"},{type:"h3",label:"見出し H3"},{type:"h4",label:"見出し H4"},{type:"h5",label:"見出し H5"},{type:"h6",label:"見出し H6"}],[{type:"text",label:"1行テキスト"},{type:"email",label:"Email"},{type:"url",label:"URL"},{type:"tel",label:"電話番号"},{type:"password",label:"パスワード"},{type:"number",label:"数値"},{type:"datepicker",label:"日付"},{type:"time",label:"時刻"},{type:"textarea",label:"複数行テキスト",rows:8},{type:"code",label:"コードブロック",rows:4},{type:"tinymce",label:"リッチテキスト",rows:8},{type:"asset",label:"ファイル",url:""},{type:"image",label:"画像",url:"",thumbnail:""}],[{type:"contentData",label:"コンテンツデータ",siteId:1,contentTypeId:1,radio:!1,modalEdit:!0,modalCreate:!0,includeDraft:!1,dataLabelName:"title"}],[{type:"select",label:"ドロップダウンリスト",options:[{label:"リンゴ",data:"apple"},{label:"オレンジ",data:"orange"},{label:"キウィフルーツ",data:"kiwi"}]},{type:"checkbox",label:"チェックボックス",options:[{label:"リンゴ",data:"apple",checked:!1},{label:"オレンジ",data:"orange",checked:!1},{label:"キウィフルーツ",data:"kiwi",checked:!1}]},{type:"radio",label:"ラジオボタン",options:[{label:"リンゴ",data:"apple"},{label:"オレンジ",data:"orange"},{label:"キウィフルーツ",data:"kiwi"}]},{type:"table",label:"表",options:[{type:"text",label:"1行テキスト"},{type:"datepicker",label:"日付"},{type:"time",label:"時刻"},{type:"textarea",label:"複数行テキスト",rows:1},{type:"tinymce",label:"リッチエディタ",rows:8},{type:"asset",label:"ファイル",filename:""},{type:"image",label:"画像",filename:"",thumbnail:""},{type:"select",label:"ドロップダウンリスト",options:[{label:"リンゴ",data:"apple"},{label:"オレンジ",data:"orange"},{label:"キウィフルーツ",data:"kiwi"}]},{type:"checkbox",label:"チェックボックス",options:[{label:"リンゴ",data:"apple"},{label:"オレンジ",data:"orange"},{label:"キウィフルーツ",data:"kiwi"}]},{type:"radio",label:"ラジオボタン",options:[{label:"リンゴ",data:"apple"},{label:"オレンジ",data:"orange"},{label:"キウィフルーツ",data:"kiwi"}]}]},{type:"table-vertical-fixed",label:"縦向き固定テーブル",options:[{type:"text",label:"1行テキスト"},{type:"datepicker",label:"日付"},{type:"time",label:"時刻"},{type:"textarea",label:"複数行テキスト",rows:1},{type:"tinymce",label:"リッチエディタ",rows:8},{type:"asset",label:"ファイル"},{type:"image",label:"画像"},{type:"select",label:"ドロップダウンリスト",options:[{label:"リンゴ",data:"apple"},{label:"オレンジ",data:"orange"},{label:"キウィフルーツ",data:"kiwi"}]},{type:"checkbox",label:"チェックボックス",options:[{label:"リンゴ",data:"apple"},{label:"オレンジ",data:"orange"},{label:"キウィフルーツ",data:"kiwi"}]},{type:"radio",label:"ラジオボタン",data:"orange",options:[{label:"リンゴ",data:"apple"},{label:"オレンジ",data:"orange"},{label:"キウィフルーツ",data:"kiwi"}]}]}],[{type:"multi-column",label:"2段組リッチテキスト",options:[{type:"tinymce",col:6},{type:"tinymce",col:6}]},{type:"multi-column",label:"3段組テキスト",options:[{type:"textarea",rows:8,col:4},{type:"textarea",rows:8,col:4},{type:"textarea",rows:8,col:4}]},{type:"multi-column-content",label:"2段組コンテンツ",options:[[{type:"text",label:"小見出し"},{type:"tinymce",label:"本文"}],[{type:"text",label:"小見出し"},{type:"tinymce",label:"本文"}]]}],[{type:"textarea",label:"定型文（セミナー案内）",rows:8,data:"日時：\n\n会場：\n\n参加費：\n\n申し込み期限："}]]},t),s=l.id,r=null,d="",p=!1;if("edit-entry"===i.screen_id||"edit-page"===i.screen_id){if(!(r=a.getElementById(s)))return;d=r.value;var c=e("#"+s+"-field");c.hasClass("required")&&(p=!0),c.after('<div id="mtapp-mf-'+s+'"></div>').remove()}else{if(void 0===i.contentDataFields||void 0===i.contentDataFields["contentField"+s])return;(r=a.querySelector('[name="content-field-'+s+'"]')).required&&(p=!0),d=r.value,r.value="",i.contentDataFields["contentField"+s].find("#block_editor_data").appendTo("#edit-content-type-data-form"),i.contentDataFields["contentField"+s].find(".modal-blockeditor").appendTo("#edit-content-type-data-form"),i.contentDataFields["contentField"+s].after('<div id="mtapp-mf-'+s+'"></div>').hide().find("textarea").attr("name","")}l.isRequired=p,d&&(d=JSON.parse(d),l.items=JSON.parse(Object.toJSON(d.items)));for(var m=0;m<l.items.length;m++)void 0===l.items[m].id&&(l.items[m].id=this.temporaryId());i.multiField=i.multiField||{},i.multiField["field"+s]={app:null,options:null},i.multiField["field"+s].app=new Vue({el:"#mtapp-mf-"+s,template:"#mf-container-tmpl",data:l,mounted:function(){e("body").on("focus.mtapp-mf-field-datepicker","input.mtapp-mf-field-datepicker",(function(){e(this).hasClass("hasDatepicker")||e(this).datepicker({dateFormat:"yy-mm-dd",dayNamesMin:["日","月","火","水","木","金","土"],monthNames:["- 01","- 02","- 03","- 04","- 05","- 06","- 07","- 08","- 09","- 10","- 11","- 12"],showMonthAfterYear:!0,prevText:"&lt;",nextText:"&gt;",onSelect:function(e,t){this.dispatchEvent(i.eventInput)}})}))},updated:function(){if("object"===_typeof(i.vueContentData))for(var e in i.vueContentData)!1===i.vueContentData[e]&&this.$refs[e].showSelectedDataLabel()},computed:{setContentData:function(){var e={items:this.items};return Object.toJSON(e)},disabledAdd:function(){return this.maxBlocks>0&&this.maxBlocks<=this.items.length}},methods:n,watch:o})},loadingImage:function(e){e="show"===e?"block":"none",a.getElementById("mtapp-loading-image").style.display=e},zeroPad:function(e,t,a){return a="string"==typeof a?a:"0",(Array(t).join(a)+e).slice(-t)},tidySeparater:function(e,t){t=t||",";var a=new RegExp("[\\s　]*"+t+"[\\s　]*","g");return e.replace(/^[\s　]+|[\s　]+$/g,"").replace(a,t)},toInt:function(e,t){return e=(e+="").replace(/０/g,"0").replace(/１/g,"1").replace(/２/g,"2").replace(/３/g,"3").replace(/４/g,"4").replace(/５/g,"5").replace(/６/g,"6").replace(/７/g,"7").replace(/８/g,"8").replace(/９/g,"9"),t||(e=e.replace(/\D/g,"")),e},numberFormat:function(e){var t=-1!==(e=""+e).indexOf(".")?e.split("."):[e];return t[0]=t[0].replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),t.join(".")},errorMessage:function(e,t,a,i){a||(a=null);var n="You have an error in "+e+": "+t;switch(a){case"alert":alert(n);break;case"console":this.console&&void 0!==console.error&&console.error(n)}return"boolean"==typeof i?i:n},objectSort:function(e,t,a,i){a="ascend"===a?-1:1,e.sort((function(e,n){var o=e[t],l=n[t];return"numeric"===i?(o-=0,l-=0):"string"===i&&(o=""+o,l=""+l),o<l?1*a:o>l?-1*a:0}))},temporaryId:function(e){return(e=!1===e?"":e||"id-")+Math.floor(1e16*Math.random()).toString(36)},removeHost:function(e){if(!e)return"";var t="";t="string"==typeof i.removeHostPattern&&i.removeHostPattern?i.removeHostPattern:"https?:/+[^/]+";var a=new RegExp("^"+t+"(.*)");return e.replace(a,"$1")},getPageScroll:function(){var e,t;return self.pageYOffset?(t=self.pageYOffset,e=self.pageXOffset):a.documentElement&&a.documentElement.scrollTop?(t=a.documentElement.scrollTop,e=a.documentElement.scrollLeft):a.body&&(t=a.body.scrollTop,e=a.body.scrollLeft),new Array(e,t)},getPageHeight:function(){var e;return self.innerHeight?e=self.innerHeight:a.documentElement&&a.documentElement.clientHeight?e=a.documentElement.clientHeight:a.body&&(e=a.body.clientHeight),e},setCookie:function(e,t,i){var n=encodeURIComponent(e)+"="+encodeURIComponent(t);if(null!=i){var o=new Date;o.setDate(o.getDate()+i),n+=";expires="+o.toUTCString()}a.cookie=n},getCookie:function(e){if(a.cookie)for(var t=a.cookie.split(";"),i=0;i<t.length;i++){var n=t[i].replace(/\s/g,"").split("=");if(n[0]===encodeURIComponent(e))return decodeURIComponent(n[1])}return""},deepCopy:function(e){return JSON.parse(Object.toJSON(e))},overlayEditor:{init:function(){e("#mtapp-overlay-editor-cancel").on("click",(function(){var t=e('#mtapp-overlay-editor-modal [aria-label="mt_source_mode"][aria-pressed="true"]');return e("#mtapp-overlay-editor:visible").length&&t.length&&t.trigger("click"),!0})),e("#mtapp-overlay-editor-modal").on({"hidden.bs.modal":function(){t.tinymce.remove("#mtapp-overlay-editor"),e("#mtapp-overlay-editor").prependTo("#mtapp-overlay-editor-inner").nextAll().remove()},"shown.bs.modal":function(){e(".modal-backdrop.show:last").css("z-index",1030),e(a).off("focusin.bs.modal")}}),e("#mtapp-overlay-editor-modal .modal-dialog").css({width:t.innerWidth/3*2,maxWidth:t.innerWidth/3*2})},open:function(i,n,o){e.extend({},o);n=void 0===n?"":n,"string"==typeof i&&(a.getElementById("mtapp-overlay-editor").value=n,e("#mtapp-overlay-editor-modal").attr("data-target-id",i).modal("show"),void 0===t.app.editors&&(t.app.editors={}),t.app.editors["mtapp-overlay-editor"]=new MT.EditorManager("mtapp-overlay-editor",{format:"richtext",wrap:!0}),e('#mtapp-overlay-editor-modal [aria-label="mt_source_mode"]').on("click",(function(){t.app.editors["mtapp-overlay-editor"].currentEditor.save()})))},save:function(){var n=e('#mtapp-overlay-editor-modal [aria-label="mt_source_mode"]');n.is('[aria-pressed="true"]')&&n.trigger("click"),t.app.editors["mtapp-overlay-editor"].currentEditor.save();var o=a.getElementById("mtapp-overlay-editor").value,l=e("#mtapp-overlay-editor-modal").modal("hide").attr("data-target-id"),s=a.getElementById(l);s.value=o,s.dispatchEvent(i.eventInput),a.getElementById(l+"-view").innerHTML=o}},assetField:{cleanup:function(){i.assetField={fieldId:"",assetId:"",assetList:{},assetType:"image"}},init:function(){var n=this;n.cleanup(),e("#mtapp-asset-field").mtModal(),e(".mt-modal").on("hidden.bs.modal.assetField",(function(){if(""!==i.assetField.assetId){var o=a.getElementById(i.assetField.fieldId);o.value=i.assetField.assetId,o.dispatchEvent(i.eventInput);var l=a.getElementById(i.assetField.fieldId+"-thumb"),s=a.getElementById(i.assetField.fieldId+"-url");if("string"==typeof t.top.mtappVars.assetField.assetList["asset-"+i.assetField.assetId+"-json"]){var r=JSON.parse(t.top.mtappVars.assetField.assetList["asset-"+i.assetField.assetId+"-json"]);s.value=mtapp.removeHost(r.url),s.dispatchEvent(i.eventInput),"image"===i.assetField.assetType&&(l.value=mtapp.removeHost(r.preview_url),l.dispatchEvent(i.eventInput))}else e.ajax({url:[i.dataapi_script_url,"v"+i.dataapi_default_version,"sites",i.blog_id,"assets",i.assetField.assetId].join("/"),dataType:"json"}).done((function(e){s.value=mtapp.removeHost(e.url),s.dispatchEvent(i.eventInput)})),"image"===i.assetField.assetType&&e.ajax({url:[i.dataapi_script_url,"v"+i.dataapi_default_version,"sites",i.blog_id,"assets",i.assetField.assetId,"thumbnail"].join("/"),data:{width:120,height:120},dataType:"json"}).done((function(e){l.value=mtapp.removeHost(e.url),l.dispatchEvent(i.eventInput)}))}n.cleanup()}))},select:function(t,a){"string"!=typeof a&&(a="image"),i.assetField.fieldId=t,i.assetField.assetType=a;var n=e("#mtapp-asset-field"),o=n.attr("href").replace(/(filter_val|require_type)=(\w+)/g,"$1="+a);return n.attr("href",o).trigger("click"),!1},remove:function(e){var t=a.getElementById(e),n=a.getElementById(e+"-thumb"),o=a.getElementById(e+"-url");t&&(t.value="",t.dispatchEvent(i.eventInput)),n&&(n.value="",n.dispatchEvent(i.eventInput)),o&&(o.value="",o.dispatchEvent(i.eventInput))},publicUrl:function(e){return e?/^http/.test(e)?e:i.site.site_url.replace(/(https?:\/\/[^\/]+).*/,"$1")+e:""}},templateListCustomize:function(t){var a=e.extend({templateNameSets:[],displayType:"listIndent",labelWeight:"bold",moveTop:!1,labelType:"block"},t);"list-template"===i.screen_id&&("listIndent"===a.displayType?e("table.listing tbody").each((function(){for(var t=e(this).find("td.template-name"),i=function(i,n){var o=void 0,l=void 0;t.find("a").filter((function(e,t){return a.templateNameSets[i].keyword instanceof RegExp?a.templateNameSets[i].keyword.test(t.innerHTML):-1!==t.innerHTML.indexOf(a.templateNameSets[i].keyword)})).each((function(t){var n=a.templateNameSets[i].replacement?a.templateNameSets[i].replacement:"";if(this.innerHTML=this.innerHTML.replace(a.templateNameSets[i].keyword,n),this.style.position="relative",this.style.left="2em",0===t){var s=(o=e(this).parents("tr")).find("td").length,r=8;e(this).parent().prevAll().each((function(){r+=e(this).width()})),o.before('<tr><td colspan="'+s+'" style="padding-left:'+r+"px;font-weight:"+a.labelWeight+';">'+a.templateNameSets[i].label+"</td></tr>")}else e(this).parents("tr").insertAfter(l);l=e(this).parents("tr")}))},n=0,o=a.templateNameSets.length;n<o;n++)i(n)})):e("table.listing tbody").each((function(){for(var t,i,n=e(this).find("td.template-name"),o=function(o,l){n.find("a").filter((function(e,t){return a.templateNameSets[o].keyword instanceof RegExp?a.templateNameSets[o].keyword.test(t.innerHTML):-1!==t.innerHTML.indexOf(a.templateNameSets[o].keyword)})).each((function(n){var l=a.templateNameSets[o].replacement?a.templateNameSets[o].replacement:"";this.innerHTML=this.innerHTML.replace(a.templateNameSets[o].keyword,l),0===n?((t=e(this).parent().prepend('<span style="display:'+a.labelType+";margin-right:5px;margin-bottom:5px;font-weight:"+a.labelWeight+';">'+a.templateNameSets[o].label+"</span>")).parent().attr("data-group-order",o),i=t.parents("tbody"),t.prevAll(".cb").find(":checkbox").remove()):e(this).closest("tr").hide().end().css({marginLeft:"5px"}).appendTo(t)}))},l=0,s=a.templateNameSets.length;l<s;l++)o(l);if(a.moveTop)for(var r=a.templateNameSets.length-1;r>=0;r--)e("[data-group-order="+r+"]").prependTo(i)})),e("tbody tr:visible").each((function(t){t%2==1?e(this).removeClass("odd even").addClass("odd"):e(this).removeClass("odd even").addClass("even")})))},getCategoryName:function(t){if(e.isArray(MT.App.categoryList)){var a=e.extend({id:-1,field:"label"},t);if(-1!==a.id&&!1!==/^\d+$/.test(a.id))for(var i=0,n=MT.App.categoryList.length;i<n;i++)if(MT.App.categoryList[i].id==a.id)return MT.App.categoryList[i][a.field]}},dataLabelCustomize:function(t){var a=e.extend({insertBefore:"#basename-field",linkedField:null},t),i=e("#data_label");a.insertBefore&&e("#data_label-field").insertBefore(a.insertBefore),null!==a.linkedField&&e(a.linkedField).on("change",(function(){i.val(e(a.linkedField).val())})),i.mtapp("enableEdit")},sidebarCollapse:function(){var t=e("body");t.hasClass("preview-screen")||(t.append('<button id="mtapp-sidebar-collapse" type="button"><svg title="Full School" role="img" class="mt-icon"><use xlink:href="'+i.static_path+'images/sprite.svg#ic_fullscreen" /></svg></button>'),e("#mtapp-sidebar-collapse").on("click",(function(){e(".mt-secondaryPanel,.mt-primaryNavigation,.mt-secondaryPanel--scrollable").toggleClass("d-none")})))},msg:function(t){var a=e.extend({msg:"",type:"info",dismissible:!1,noInsert:!1},t),i=a.dismissible?'<div class="alert alert-'+a.type+' alert-dismissible fade show" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="閉じる"><span aria-hidden="true">&times;</span></button>'+a.msg+"</div>":'<div class="alert alert-'+a.type+'">'+a.msg+"</div>";if(a.noInsert)return i;var n=e("#msg-block");n.length?n.append(i):e("#page-title").after(i)},makeWidget:function(t){var a=e.extend({basename:"",label:"",content:"",action:"",footer:""},t);return['<div id="'+(""!==a.basename?a.basename:mtapp.temporaryId())+'-field" class="mt-widget">','<h2 class="mt-widget__title"><span class="'+(a.action?"mt-widget__sitelist":"")+'">'+a.label+"</span>"+a.action+"</h2>",'<div class="mt-widget__content">'+a.content+a.footer+"</div>","</div>"].join("")},makeField:function(t){var a=e.extend({basename:"",label:"",content:"",hint:""},t),i=""!==a.basename?a.basename:mtapp.temporaryId(),n=a.hint?'<small class="form-text text-muted">'+a.hint+"</small>":"",o=a.required?'<span class="badge badge-danger">必須</span>':"";return['<div id="'+i+'-field" class="form-group">','<label class="first-child">'+a.label+o+"</label>",a.content+n,"</div>"].join("")},duplicateContent:function(a){var n=e.extend({additionalText:"のコピー",contentDataTitleFieldId:0,cbModifyContent:null},a);if(void 0===i._hasDuplicateContent){i._hasDuplicateContent=!0;var o='<button type="button" id="mtapp-duplicate-button" class="btn btn-warning text-white">複製</button>';-1!==["edit-content-type-data","edit-entry"].indexOf(i.screen_id)?e("#entry-publishing-widget").find(".btn-primary:last").parent().append(o):-1!==["list-content_data","list-entry"].indexOf(i.screen_id)&&e(t).on("listReady.mtapp.duplicate",(function(){e('#actions-bar-top [data-action-id="delete"]').after(o),e(t).off("listReady.mtapp.duplicate")}));var l=e("body"),s=e("#mtapp-modal-duplicate"),r=e("#mtapp-modal-duplicate-new-title"),d=e("#mtapp-modal-duplicate-submit");l.on("mtapp.duplicate",(function(t,a,n){if(!e.isArray(a)||0===a.length)return alert("Invalid arguments");var o=function(){var e=0;mtapp.loadingImage("show"),-1!==["edit-content-type-data","list-content_data"].indexOf(i.screen_id)?a.forEach((function(t){var n=Object.toJSON(t);i.DataAPI.createContentData(i.blog_id,i.content_type_id,n,(function(t){if(t.error)return mtapp.loadingImage("hide"),void mtapp.modalMsg({type:"error",title:"エラー",content:t.error.message});t.id&&++e===a.length&&(location.href=1===e?i.adminScript+"?__mode=view&content_type_id="+i.content_type_id+"&_type=content_data&id="+t.id+"&type=content_data_"+i.content_type_id+"&blog_id="+i.blog_id:i.adminScript+"?__mode=list&_type=content_data&type=content_data_"+i.content_type_id+"&blog_id="+i.blog_id)}))})):-1!==["edit-entry","list-entry"].indexOf(i.screen_id)&&a.forEach((function(t){var n=Object.toJSON(t);i.DataAPI.createEntry(i.blog_id,n,(function(t){if(t.error)return mtapp.loadingImage("hide"),void mtapp.modalMsg({type:"error",title:"エラー",content:t.error.message});t.id&&++e===a.length&&(location.href=1===e?i.adminScript+"?__mode=view&_type=entry&blog_id="+i.blog_id+"&id="+t.id:i.adminScript+"?__mode=list&_type=entry&blog_id="+i.blog_id)}))}))};n?mtapp.modalConfirm({content:"複製しますか？",callback:function(){o()}}):o()})),l.on("click.duplicateContent","#mtapp-duplicate-button",(function(){var t=[];if(-1!==["edit-content-type-data","edit-entry"].indexOf(i.screen_id)){if(!i.id)return void mtapp.modalMsg({type:"error",title:"エラー",content:"複製するコンテンツが保存されていません。"});t.push(i.id)}else if(-1!==["list-content_data","list-entry"].indexOf(i.screen_id)&&(e('[data-is="list-table"] [name="id"]:checked').each((function(){t.push(e(this).val())})),0===t.length))return void mtapp.modalMsg({type:"error",title:"エラー",content:"複製するコンテンツが選択されていません。"});-1!==["edit-content-type-data","list-content_data"].indexOf(i.screen_id)?(mtapp.loadingImage("show"),i.DataAPI.listContentData(i.blog_id,i.content_type_id,{limit:1e3,includeIds:t.join(",")},(function(e){if(mtapp.loadingImage("hide"),e.error)mtapp.modalMsg({type:"error",title:"エラー",content:e.error.message});else if(0!==e.items.length){mtapp.loadingImage("hide");var t="",a=e.items.map((function(e){if(delete e.id,e.status="Draft",n.contentDataTitleFieldId){n.contentDataTitleFieldId=Number(n.contentDataTitleFieldId);for(var a=0;a<e.data.length;a++)Number(e.data[a].id)===n.contentDataTitleFieldId&&(t=e.data[a].data+n.additionalText,e.data[a].data=t)}else t=e.label+n.additionalText;return e.label=t,"function"==typeof n.cbModifyContent&&(e=n.cbModifyContent(e)),e}));"edit-content-type-data"===i.screen_id?(r.val(t),s.modal(),d.off("click.mtapp.duplicate").on("click.mtapp.duplicate",(function(){if(n.contentDataTitleFieldId){n.contentDataTitleFieldId=Number(n.contentDataTitleFieldId);for(var e=0;e<a[0].data.length;e++)Number(a[0].data[e].id)===n.contentDataTitleFieldId&&(a[0].data[e].data=r.val())}a[0].label=r.val(),s.modal("hide"),l.trigger("mtapp.duplicate",[a,!1])}))):"list-content_data"===i.screen_id&&l.trigger("mtapp.duplicate",[a,!0])}else mtapp.modalMsg({type:"error",title:"エラー",content:"複製元のデータが見つかりません。"})}))):-1!==["edit-entry","list-entry"].indexOf(i.screen_id)&&(mtapp.loadingImage("show"),i.DataAPI.listEntries(i.blog_id,i.content_type_id,{limit:1e3,includeIds:t.join(",")},(function(e){if(mtapp.loadingImage("hide"),e.error)mtapp.modalMsg({type:"error",title:"エラー",content:e.error.message});else if(0!==e.items.length){var t="",a=e.items.map((function(e){return delete e.id,e.status="Draft",t=e.title+n.additionalText,e.title=t,"function"==typeof n.cbModifyContent&&(e=n.cbModifyContent(e)),e}));"edit-entry"===i.screen_id?(r.val(t),s.modal(),d.off("click.mtapp.duplicate").on("click.mtapp.duplicate",(function(){a[0].title=r.val(),s.modal("hide"),l.trigger("mtapp.duplicate",[a,!1])}))):"list-entry"===i.screen_id&&l.trigger("mtapp.duplicate",[a,!0])}else mtapp.modalMsg({type:"error",title:"エラー",content:"複製元のデータが見つかりません。"})})))}))}},duplicate:function(t){var a=e.extend({changeBlog:!1,contentDataTitleFieldName:"data_label"},t);if(void 0===i._hasDuplicateContent){i._hasDuplicateContent=!0,"entry"!==i.type&&(a.changeBlog=!1);var n='<button type="button" id="mtapp-duplicate-button" class="btn btn-warning">複製</button>';if(a.changeBlog){var o=[];if(a.changeBlog&&i.me.permission.can_create_post_blogs&&i.permitted_sites)for(var l=0;l<i.permitted_sites.length;l++){var s=i.permitted_sites[l].id-0,r=i.permitted_sites[l].name,d=s==i.blog_id?' selected="selected"':"";-1!==e.inArray(s,i.me.permission.can_create_post_blogs)&&o.push("<option"+d+' value="'+s+'">'+r+"</option>")}e("#entry-publishing-widget").after(mtapp.makeWidget({label:"ブログの変更",content:'<select class="form-control" id="mtapp-duplicate-blog-id">'+o.join("")+"</select><p>"+n+"</p>"}))}else e("#entry-publishing-widget").find(".btn-primary:last").parent().append(n);var p=e("#mtapp-duplicate-button"),c=p.closest("form"),m=null;m="edit-content-type-data"===i.screen_id?e('[name="'+a.contentDataTitleFieldName+'"]'):e('[name="title"]');var u=e("#mtapp-modal-duplicate-new-title");e("#mtapp-modal-duplicate-submit").on("click",(function(){confirm("複製しますか？")&&(m.val(u.val()),c.trigger("submit"))})),p.on("click",(function(){c.find("[name]").each((function(){switch(e(this).attr("name")){case"id":e(this).after('<input type="hidden" name="author_id" value="'+i.author_id+'" />').remove();break;case"blog_id":var t=a.changeBlog?e("#mtapp-duplicate-blog-id").val():e(this).val();e(this).val(t);break;case"return_args":e(this).val(this.value.replace(/&amp;id=[0-9]+|&id=[0-9]+/,""));break;case"status":e(this).val(1)}})),e("#mtapp-modal-duplicate").off("shown.bs.modal").on("shown.bs.modal",(function(){u.val(m.val()+"のコピー")})).modal()}))}},modalConfirm:function(t){var i=e.extend({type:"",title:"確認",content:"よろしいですか？",callback:function(){alert("OKボタンがクリックされました！")}},t);i.type&&(i.title='<svg role="img" class="mt-icon--'+i.type+' mt-icon--sm">'+mtappIcons[i.type]+"</svg> "+i.title),a.getElementById("mtapp-modal-confirm-title").innerHTML=i.title,a.getElementById("mtapp-modal-confirm-content").innerHTML=i.content,e("#mtapp-modal-confirm-dialog").addClass("modal-"+i.size);var n=e("#mtapp-modal-confirm").attr("data-mtapp-type",i.type)
;n.on("show.bs.modal",(function(){e("#mtapp-modal-confirm-submit").off("click.mtapp.confirm").on("click.mtapp.confirm",(function(){n.modal("hide"),i.callback()}))})),n.modal()},modalMsg:function(t){var i=e.extend({type:"",title:"Thank you",content:"MTAppjQueryをご利用いただきありがとうございます！",size:"",callbacks:[]},t);i.type&&(i.title='<svg role="img" class="mt-icon--'+i.type+' mt-icon--sm">'+mtappIcons[i.type]+"</svg> "+i.title),a.getElementById("mtapp-modal-message-title").innerHTML=i.title,a.getElementById("mtapp-modal-message-content").innerHTML=i.content,e("#mtapp-modal-message-dialog").addClass("modal-"+i.size);var n=e("#mtapp-modal-message").attr("data-mtapp-type",i.type);if(i.callbacks.length>0)for(var o=0;o<i.callbacks.length;o++){var l=i.callbacks[o].type,s=i.callbacks[o].action;n.off(l).on(l,s)}n.modal()},debug:function(a){var n=e.extend({id:!1},a),o=e("body"),l=o.attr("id")||"",s=o.attr("class").replace(/ +/g,".");l&&(l="#"+l.trim()),s&&(s="."+s.trim());var r=['<pre id="mtapp-show-basename"></pre>','<pre id="mtapp-debug-pageinfo-content" class="msg-text">body'+l+s+"</pre>"];mtapp.msg({msg:r.join("\n"),type:"info",dismissible:!0}),console.warn("mtappVars",i);var d=[],p=e(".mt-mainContent");p.length?(p.find("div.field:visible").each((function(){var t=e(this).attr("id").replace(/-field$/,"");d.push(t),e(this).before('<input type="text" value="'+t+'" class="form-control" />')})),e("#msg-block").after(mtapp.makeField({label:"現在の並び順",content:'<textarea id="mtapp-fieldsort" class="form-control">'+d.join(",")+"</textarea>"}))):e("#mtapp-show-basename").hide(),"list-entry"==i.screen_id&&e(t).bind("listReady",(function(){e("#entry-table").find("span.draft").closest("tr").css({background:"#FFCBD0"})})),"list_category"==i.template_filename&&e(t).bind("listReady",(function(){e("#root").find("div").each((function(){var t=e(this).attr("id");e(this).mtapp("showHint",{text:"ID: "+t})}))})),(n.id&&"list_template"==i.template_filename||"list_widget"==i.template_filename)&&e("table.listing-table").find("th.cb").each((function(){e(this).insertListingColum("after","th","ID","id num")})).end().find("td.cb").each((function(){var t=e(this).find("input:checkbox").val();e(this).insertListingColum("after","td",t,"id num")})),n.id&&"list_common"==i.template_filename&&!e('#disp_cols label:contains("ID")').length&&e(t).bind("listReady",(function(){e("table.listing-table").find("tr").each((function(){var t=e(this).attr("id");e(this).find("th.cb").insertListingColum("after","th","ID","id num").end().find("td.cb").insertListingColum("after","td",t,"id num")}))}))},fieldSort:function(i){var n=e.extend({sort:"title,text,tags,excerpt,keywords",insertID:"sortable",otherFieldHide:!1,debug:!1},i),o=n.sort.split(",").reverse(),l=o.length;if(0!=l){var s=a.getElementById(n.insertID);if(s){n.otherFieldHide&&(e(s).find("div.field").addClass("d-none"),e("#quickpost").addClass("d-none"));for(var r=0;r<l;r++){var d=e.trim(o[r]).replace(/^c:/,"customfield_")+"-field";if(a.getElementById(d)){var p=a.getElementById(d);s.insertBefore(p,s.firstChild),e(p).removeClass("d-none").show()}n.debug&&t.console&&console.warn("#"+d+" が見つかりません")}}}},moveToWidget:function(t){var a=e.extend({makeWidget:!0,widgetBasename:"",widgetLabel:"New Widget",widgetContentTop:"",widgetContentBottom:"",widgetAction:"",widgetFooter:"",basename:"",selector:"",pointerSelector:"",method:"after"},t);if(""===a.pointerSelector)return mtapp.errorMessage("MTAppMoveToWidget","pointerSelector is required","alert",!1);var i=""!==a.selector?a.selector.split(","):[];if(""!==a.basename&&"string"==typeof a.basename)for(var n=a.basename.split(","),o=0,l=n.length;o<l;o++)i.push("#"+n[o].replace(/^c:/,"customfield_")+"-field");var s=mtapp.temporaryId(),r="";switch(r=a.makeWidget?mtapp.makeWidget({basename:a.widgetBasename,label:a.widgetLabel,content:a.widgetContentTop+'<div id="'+s+'"></div>'+a.widgetContentBottom,action:a.widgetAction,footer:a.widgetFooter}):'<div id="'+s+'"></div>',a.method){case"before":e(a.pointerSelector).before(r);break;case"append":e(a.pointerSelector).append(r);break;case"prepend":e(a.pointerSelector).prepend(r);break;default:e(a.pointerSelector).after(r)}for(var d=0,p=i.length;d<p;d++)e(i[d]).each((function(){e(this).removeClass("hidden").removeClass("sort-enabled d-none").show(),e(this).appendTo("#"+s)}))},submitButtonControl:function(t){var a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];switch(t){case"init":void 0===i._system.submitButtons&&(i._system.submitButtons=e('[type="submit"].btn-primary'));break;case"hasError":i._system.submitButtons&&(i._system.submitButtons.prop("disabled",!0),i._system.submitButtons.each((function(){!e(this).hasClass("mtapp-has-error")&&a&&e(this).addClass("mtapp-has-error").append('<svg title="Stop" role="img" class="mt-icon--inverse mt-icon--sm ml-2"><use xlink:href="'+i.static_path+'images/sprite.svg#ic_error"></use></svg>')})));break;case"submittable":i._system.submitButtons&&(i._system.submitButtons.prop("disabled",!1),i._system.submitButtons.find("svg").remove(),i._system.submitButtons.each((function(){e(this).removeClass("mtapp-has-error").find("svg").remove()})))}},tabs:function(t){var a=e.extend({content:[],pointer:"",method:"after"},t),i=a.content.length;if(0!==i&&""!==a.pointer&&0!==e(a.pointer).length){for(var n=[],o=[],l=0;l<i;l++){var s=0===l?" show active":"";void 0===a.content[l].id&&(a.content[l].id=mtapp.temporaryId("tab-")),n.push('<li class="nav-item"><a class="nav-link'+s+'" data-toggle="tab" href="#'+a.content[l].id+'" role="tab">'+a.content[l].label+"</a></li>"),o.push('<div class="tab-pane fade'+s+'" id="'+a.content[l].id+'" role="tabpanel"></div>')}e(a.pointer)[a.method]('<div class="card text-center my-6"><div class="card-header"><ul class="nav nav-tabs card-header-tabs" role="tablist">'+n.join("")+'</ul></div><div class="card-body tab-content text-left">'+o.join("")+"</div></div>");for(var r=function(t){var i=a.content[t].id,n=a.content[t].selector;e(n).each((function(){e("#"+i).append(this)}))},d=0;d<i;d++)r(d)}},sortDisabled:function(){var t=e("#sortable");t.length&&(t.sortable({disabled:!0}),t.find("div.sort-enabled").removeClass("sort-enabled").find("svg:first").parent().next().addClass("pl-4").css("font-weight",600).end().remove())},customize:function(t){var a,i,n=e.extend({basename:"",label:"",addClass:"",hint:"",showField:"",showParent:"",custom:!1,widget:!1,edit:!1},t),o=n.label+"",l=n.hint+"",s=n.custom,r=n.widget,d=n.edit,p=s?"customfield_"+n.basename:n.basename+"";if(""!==p){switch(p){case"body":(a=e("#text-field")).find("#editor-header div.tab:eq(0)"),i=a.find("#editor-header label:eq(0) a");break;case"more":(a=e("#text-field")).find("#editor-header div.tab:eq(1)"),i=a.find("#editor-header label:eq(1) a");break;case"assets":i=(a=e("#assets-field")).find("h2 span"),a;break;default:i=r?(a=e("#entry-"+p+"-widget")).find(".mt-widget__title").eq(0):(a=e("#"+p+"-field")).find("label").eq(0),a}n.add_class&&(n.addClass=n.add_class),n.addclass&&(n.addClass=n.addclass),""!==n.addClass&&a.addClass(n.addClass),""!==o&&(i.text(o),"title"===p&&a.find("div.field-header").show().end().find("#title").attr("placeholder",o));var c=n.show_field?n.show_field+"":n.showField+"";return"show"===c?"body"===p||"more"===p?i.closest("div.tab").removeClass("d-none"):a.removeClass("d-none").addClass("d-block"):"hide"===c&&"body"!==p&&"more"!==p?a.addClass("d-none"):"hide"!==c||"body"!==p&&"more"!==p||i.closest("div.tab").addClass("d-none"),n.showParent=n.show_parent?n.show_parent+"":n.showParent+"","body"!==p&&"more"!==p||"hide"!==n.showParent?"body"!==p&&"more"!==p||"show"!==n.showParent||a.removeAttr("style"):a.css({position:"absolute",top:"-9999px",left:"-9999px",width:"1px",height:"1px"}),l&&a.mtapp("showHint",{text:l}),d&&a.find(".mt-draggable__content").length&&a.find(".mt-draggable__content").addClass("d-none").after('<button type="button" class="btn btn-default ml-5">編集</button>').next("button").on("click.mtappcustomize",(function(){e(this).prev().removeClass("d-none"),e(this).remove()})),a}alert("basenameが設定されていません")},startObserveCategoryChange:function(){var n=a.getElementById("category-ids");if(n){var o=e("#category-ids");i.selectedCategories=n.value,t.setInterval((function(){i.selectedCategories!==n.value&&(i.selectedCategories=n.value,o.trigger("mtappCategoryChanged",[n.value]))}),150)}},initBody:function(){e("body").addClass("blog-id-"+i.blog_id+" author-id-"+i.author_id).data("MTAppAssetFieldsIDs",[])},init:function(){if(top===t||"undefined"!=typeof mtappDialogEdit){void 0===i._system&&(i._system={}),i.eventInput;try{i.eventInput=new CustomEvent("input")}catch(e){i.eventInput=a.createEvent("UIEvents"),i.eventInput.initEvent("input",!1,!1)}this.submitButtonControl("init"),i.adminScript=location.href.replace(/\?.*/,""),i.MTAppObsDialog={dialog:null,open:!1,interval:800,callbackTargetSelector:"",obs:function(){null===i.MTAppObsDialog.dialog&&(i.MTAppObsDialog.dialog=e("div.mt-dialog,div.mt-modal").not("#mtapplisting-dialog"));var t=setTimeout(i.MTAppObsDialog.obs,i.MTAppObsDialog.interval);i.MTAppObsDialog.dialog.is(":visible")&&!1===i.MTAppObsDialog.open?i.MTAppObsDialog.open=!0:i.MTAppObsDialog.dialog.is(":hidden")&&!0===i.MTAppObsDialog.open&&(i.MTAppObsDialog.open=!1,i.MTAppObsDialog.callbackTargetSelector&&e(i.MTAppObsDialog.callbackTargetSelector).trigger("MTAppDialogClosed"),clearTimeout(t))}},this.assetField.init(),this.sidebarCollapse(),this.overlayEditor.init(),this.initBody(),this.getContentDataFields(),this.startObserveCategoryChange()}else if(-1!==location.search.indexOf("__mode=list_asset")&&-1!==location.search.indexOf("_type=asset")&&-1!==location.search.indexOf("dialog_view=1")&&""!==t.top.mtappVars.assetField.fieldId){e(t).on("beforeunload.assetField",(function(){var a=e('#select_asset [name="id"]').val();if(a){t.top.mtappVars.assetField.assetId=a;var i=e("#asset-table");i.length&&i.find("td.cb :hidden").each((function(){this.value&&(t.top.mtappVars.assetField.assetList[e(this).attr("id")]=this.value)}))}})),e('.close[data-dismiss="modal"], .mt-close-dialog').on((function(){e(t).off("beforeunload.assetField")}))}}}}(jQuery,window,document,window.mtappVars);var mtapp=new BP;!function(e,t){var a={tooltip:function(t){var a=e.extend({html:"",className:"",remove:!1},t);return this.each((function(){if(a.remove)e(this).off("mouseenter.mtappTooltip").off("mouseleave.mtappTooltip").off("mousemove.mtappTooltip");else{a.text&&""===a.html&&(a.html=a.text),"string"==typeof a.className&&""!==a.className||(a.className="bg-light");var t,i,n=e(this),o=e("#mtapp-tooltip").addClass(a.className);""!==a.html?i=a.html:(t=this.title?"title":"alt",i=n.attr(t)),n.on({"mouseenter.mtappTooltip":function(e){""===a.html&&n.attr(t,""),o.stop(!0,!0).fadeIn("fast").html(i).css({position:"absolute",top:e.pageY-20,left:e.pageX+20})},"mouseleave.mtappTooltip":function(){""===a.html&&n.attr(t,i),o.fadeOut("fast")},"mousemove.mtappTooltip":function(e){o.css({top:e.pageY-20,left:e.pageX+20})}})}}))},enableEdit:function(t){var a=e.extend({text:"編集"},t);return this.each((function(){if(""!==this.value){var t=e(this);t.wrap('<div class="form-inline"></div>'),t.prop("readonly",!0);var i=e('<button class="btn btn-default ml-2" type="button">'+a.text+"</button>").on("click",(function(){return e(this).hide().prev().prop("readonly",!1).parent().removeClass("form-inline"),!1}));t.after(i)}}))},inlineEdit:function(t){var a=e.extend({edit:"編集",force:!1},t);return this.each((function(){var t=e(this),i=e('<button class="btn btn-default ml-3" type="button">'+a.edit+"</button>").on("click",(function(){return e(this).hide().prev().show().addClass("edited").prev().hide(),!1})),n=t.val();(a.force||""!==n)&&(n=""!==n?n:"...",t.before("<span>"+n+"</span>").after(i).hide())}))},tabToSpace:function(t){var a=e.extend({text:"    "},t);return this.each((function(){e(this).on("keydown",(function(t){if(9==(t.which||t.keyCode))return e(this).insertAtCaret(a.text),!1}))}))},removeVal:function(){return this.each((function(){var a=e(this).css("padding-right","16px").wrap('<div class="mtapp-remove-val" style="position:relative;" />'),i=a.parent(),n=i.outerHeight()/2-7;i.append('<img class="mtapp-remove-val-btn" alt="" src="'+t.static_plugin_path+'images/cancel-gray.png" style="top: '+n+'px;" />').children("img").on("click",(function(){a.val("").trigger("focus")}))}))},showHint:function(t){var a=e.extend({html:""},t);return this.each((function(){a.text&&""===a.html&&(a.html=a.text);var t=['<div class="balloon d-none">','<div class="balloon-content">'+a.html+"</div>",'<div class="balloon-arrow">','<div class="line10"></div>','<div class="line9"></div>','<div class="line8"></div>','<div class="line7"></div>','<div class="line6"></div>','<div class="line5"></div>','<div class="line4"></div>','<div class="line3"></div>','<div class="line2"></div>','<div class="line1"></div>',"</div>","</div>"],i=e(this).prepend(t.join("")).find("div.balloon");e(this).hover((function(){i.removeClass("d-none").addClass("d-block").css("margin-top","-"+i.outerHeight()+"px")}),(function(){i.removeClass("d-block").addClass("d-none")}))}))},fieldSplit:function(t){var a=e.extend({splitCount:2,separator:",",placeholders:[],styles:[],classes:[],debug:!1},t);return this.each((function(){var t=e(this),i=a.separator,n=a.splitCount>1?a.splitCount:2,o=t.val()?t.val().split(a.separator):[];a.debug||t.hide();var l=[],s="",r="",d="",p="";a.placeholders=a.placeholder?a.placeholder:a.placeholders;for(var c=0;c<n;c++)s=o[c]?o[c]:"",r=a.placeholders[c]?a.placeholders[c]:"",d=a.styles[c]?a.styles[c]:"",p=a.classes[c]?a.classes[c]:"",l.push('<div class="'+p+'"><input type="text" class="form-control" value="'+s+'" placeholder="'+r+'" style="'+d+'" /></div>');var m=e('<div class="row MTAppFieldSplit">'+l.join("")+"</div>").find(".form-control").each((function(){e(this).on({blur:function(){var a=[];e(this).closest(".MTAppFieldSplit").find(".form-control").each((function(){a.push(e(this).val())})),t.val(a.join(i))},keydown:function(a){if(13==a.which){var n=[];e(this).closest(".MTAppFieldSplit").find(".form-control").each((function(){n.push(e(this).val())})),t.val(n.join(i))}}})})).end();t.after(m)}))},dateAssist:function(){var t=new Date;return this.each((function(){var a=e(this);a.after('<div class="btn-group d-block mt-2" role="group"><button type="button" class="btn btn-default" data-days="0">今日</button><button type="button" class="btn btn-default" data-days="1">明日</button><button type="button" class="btn btn-default" data-days="2">明後日</button></div>').next().on("click",".btn",(function(){var i=e(this).attr("data-days")-0,n=t.getTime()+24*i*60*60*1e3;a.val(function(e){var t=new Date(e);return t.getFullYear()+"-"+mtapp.zeroPad(t.getMonth()+1,2)+"-"+mtapp.zeroPad(t.getDate(),2)}(n))}))}))},numChecker:function(t){var a=e.extend({min:null,max:null,zeroPad:0},t);return this.each((function(){var t=e(this),i=t.before('<div class="alert alert-danger mtapp-numChecker" role="alert" style="display: none;"></div>').prev();t.on("blur",(function(){var n=""+e(this).val().trim();if(n=mtapp.toInt(n,!0),t.val(n),""===n)return!0;"number"!=typeof(n=Number(n))||isNaN(n)?i.text("数値以外の文字が含まれています。").show():(i.hide(),"number"==typeof a.min&&"number"==typeof a.max?n<a.min||a.max<n?i.html('入力できる値は<strong class="mx-1">'+a.min+'</strong>から<strong class="mx-1">'+a.max+"</strong>までです。").show():i.hide():"number"==typeof a.min?n<a.min?i.html('入力できる最小値は<strong class="mx-1">'+a.min+"</strong>までです。").show():i.hide():"number"==typeof a.max&&(a.max<n?i.html('入力できる最大値は<strong class="mx-1">'+a.max+"</strong>までです。").show():i.hide()),0!==a.zeroPad&&(a.zeroPad=a.zeroPad-0,n=mtapp.zeroPad(n,a.zeroPad)),t.val(n))})).trigger("blur")}))},taxAssist:function(t){var a=e.extend({rate:.1,rounding:"floor"},t);return this.each((function(){var t=e(this);t.after('<div class="btn-group d-block mt-2" role="group"><button type="button" class="btn btn-default taxes_included">税込み</button><button type="button" class="btn btn-default after_taxes">税抜き</button><button type="button" class="btn btn-default" disabled>リセット</button></div>').next().on("click","button",(function(){var n=e(this);if(n.hasClass("taxes_included")){t.data("original",t.val()),n.removeClass("btn-default").addClass("btn-dark"),n.next().prop("disabled",!0),n.next().next().prop("disabled",!1);var o=Number(t.val())*(1+a.rate);t.val(i(o,a.rounding))}else if(n.hasClass("after_taxes")){t.data("original",t.val()),n.removeClass("btn-default").addClass("btn-dark"),n.prev().prop("disabled",!0),n.next().prop("disabled",!1);var l=Number(t.val())/(1+a.rate);t.val(i(l,a.rounding))}else t.val(t.data("original")),n.siblings().each((function(){e(this).prop("disabled",!1).removeClass("btn-dark").addClass("btn-default")}));n.prop("disabled",!0)}))}));function i(e,t){switch(t){case"floor":e=Math.floor(e);break;case"ceil":e=Math.ceil(e);break;case"round":e=Math.round(e)}return e}},maxLength:function(a){var i=e.extend({l10n:null,maxLength:0},a);if(!(i.maxLength<1)){var n={};return"ja"===t.language?(n.characters="文字",n.maximumCharacters="最大文字数",n.remainingCharacters="残り文字数",n.overCharacters="最大文字数を[_1]文字超えています"):(n.characters="",n.maximumCharacters="Maximum characters",n.remainingCharacters="Remaining characters",n.overCharacters="[_1] characters over"),i.l10n&&e.extend(n,i.l10n),this.each((function(t){var a=i.maxLength;e(this).after('<div class="valid-feedback"></div><div class="invalid-feedback"></div>');var l=e(this).next(),s=l.next();e(this).on("keyup",(function(){var t=e(this),i=t.val().length;i>a?(t.removeClass("is-valid").addClass("is-invalid"),s.text(o(a,i,n)),mtapp.submitButtonControl("hasError")):(l.text(o(a,i,n)),t.removeClass("is-invalid").addClass("is-valid"),mtapp.submitButtonControl("submittable"))})).trigger("keyup")}))}function o(e,t,a){if(!t)return a.maximumCharacters+" : "+e+a.characters;if(t<=e)return a.remainingCharacters+" : "+(e-t)+a.characters;if(t>e){var i=t-e;return a.overCharacters.replace(/\[_1\]/,i)}}},multiCheckbox:function(a){var i=e.extend({l10n:null,label:"",maxCount:999999999,maxCountMessage:"",add:!1,sort:"",debug:!1},a),n={};return"ja"===t.language?(n.maxCountMessage="選択出来る上限数を超えました。",n.addItem="項目を追加"):(n.maxCountMessage="Exceed the check limit.",n.addItem="Add an item"),i.l10n&&e.extend(n,i.l10n),this.each((function(){var t=e(this);t.next().filter((function(){return-1!==this.innerHTML.indexOf("最大文字数")})).hide();var a=this.value?mtapp.tidySeparater(this.value,",").split(","):[],o=e.type(i.label),l=[],s=[],r=mtapp.temporaryId(),d=t.after('<div id="'+r+'"></div>').next();if(i.debug||t.hide(),"object"===o)if(""===i.sort)for(var p in i.label)l.push(b(i.label[p],p));else for(var c=function(e,t){var a=[];for(var i in e)a.push(i);switch(t){case"ascend":a.sort();break;case"descend":a.sort(),a.reverse()}return a}(i.label,i.sort),m=0,u=c.length;m<u;m++)l.push(b(i.label[c[m]],c[m]));else if("string"===o||"array"===o){switch(o){case"string":""===i.label&&t.attr("title")?e.merge(s,mtapp.tidySeparater(t.attr("title")).split(",")):e.merge(s,mtapp.tidySeparater(i.label).split(",")),i.label=e.merge([],s);break;case"array":e.merge(s,i.label)}if(a.length>0&&i.add)for(var f=0,h=a.length;f<h;f++)-1===e.inArray(a[f],i.label)&&s.push(a[f]);"ascend"==i.sort?s.sort():"descend"===i.sort&&(s.sort(),s.reverse());for(var v=0,g=s.length;v<g;v++)l.push(b(s[v],s[v]));i.add&&l.push('<input class="mcb-add-item form-control" type="text" value="" placeholder="'+n.addItem+'">')}function b(e,t){var a=mtapp.temporaryId();return'<div class="form-check form-check-inline"><input class="form-check-input" id="'+a+'" type="checkbox" value="'+t+'"><label class="form-check-label" for="'+a+'">'+e+"</label></div>"}d.html(l.join("")).on("click","input:checkbox",(function(e){var a=[];if(d.find(":checked").length>i.maxCount)return i.maxCountMessage?alert(i.maxCountMessage):alert(n.maxCountMessage),!1;d.find(":checked").each((function(){a.push(this.value)})),t.val(a.join(","))})),a.length>0&&d.find(":checkbox").each((function(){var t=this.value;-1!==e.inArray(t,a)&&e(this).prop("checked",!0)})),i.add&&d.find("input.mcb-add-item").on("keypress",(function(t){if(13==(t.which||t.keyCode)){var a=e(this).val();return!!a&&(1===(a=a.split(":")).length&&e.merge(a,a),e(this).val("").before(b(a[1],a[0])).prev().find("input:checkbox").trigger("click"),!1)}return!0}))}))},suggest:function(t){var a=e.extend({list:[],hideMaxLengthText:!0},t);return this.each((function(){var t=e(this);a.hideMaxLengthText&&t.next().filter((function(){return-1!==this.innerHTML.indexOf("最大文字数")})).hide();var i=mtapp.temporaryId("suggestion-"),n=mtapp.temporaryId("completion-");e.data(this,"suggestList",a.list),t.closest("div.field").css("overflow","visible"),t.after('<div class="field-suggestion" id="'+i+'" style="display:none;"><div class="field_completion" id="'+n+'"></div></div>');var o=document.getElementById(i),l=document.getElementById(n);return e(l).on("click","div",(function(){var a=t.val().replace(/(, )?([^,]*)$/,"$1");t.val(a+e(this).text()+", ")})),t.on({blur:function(){setTimeout((function(){o.style.display="none"}),100)},keydown:function(a){if(13==(a.which||a.keyCode)){var i=e(l).children(".complete-highlight");if(i.length>0){var n=t.val().replace(/(, )?([^,]*)$/,"$1");t.val(n+i.text()+", ")}return o.style.display="none",!1}},keyup:function(t){var i=e(l).children(".complete-highlight");switch(t.which){case 40:return i[0].nextSibling&&i.removeClass("complete-highlight").addClass("complete-none").next().addClass("complete-highlight"),!1;case 38:return i[0].previousSibling&&i.removeClass("complete-highlight").addClass("complete-none").prev().addClass("complete-highlight"),!1;default:var n=[],s=!0,r=e(this).val().match(/(?:, )?([^,]*)$/)[1].toLowerCase();if(""!==r){for(var d=0,p=a.list.length;d<p;d++)a.list[d].toLowerCase().indexOf(r)>=0&&(s?(n.push('<div class="complete-highlight">'+a.list[d]+"</div>"),s=!1,o.style.display="block"):n.push('<div class="complete-none">'+a.list[d]+"</div>"));l.innerHTML=n.join(""),0==n.length&&(o.style.display="none")}else o.style.display="none"}}}),!1}))},dynamicSelect:function(t){var a=e.extend({debug:!1,dynamic:!0,text:"",addText:"項目を追加する",promptMsg:"追加する項目名を入力",initGroupName:"選択中アイテム",separateMode:!1,selected:null},t);return this.each((function(){var t=e(this),i=t.val()||"";a.debug||t.hide();var n=[],o="",l=!1;if("string"==typeof a.text){var s=a.text.split(",");!a.separateMode&&e.inArray(i,s)<0&&s.unshift(i);for(var r=0,d=s.length;r<d;r++){var p=b(s[r]);o=i==p[0]?' selected="selected"':"",n.push('<option value="'+p[0]+'"'+o+">"+p[1]+"</option>")}}else if("object"==_typeof(a.text)){for(var c in a.text){n.push('<optgroup label="'+c+'">');for(var m=0,u=a.text[c].length;m<u;m++){var f=b(a.text[c][m]);i==f[0]?(o=' selected="selected"',l=!0):o="",n.push('<option value="'+f[0]+'"'+o+">"+f[1]+"</option>")}n.push("</optgroup>")}i&&!l&&n.unshift('<optgroup label="'+a.initGroupName+'"><option value="'+i+'">'+i+"</option></optgroup>")}var h=a.dynamic?'<option value="_add_">'+a.addText+"</option>":"",v=['<select class="dynamic_select form-control">',n.join(""),h,"</select>"],g=e(v.join("")).change((function(){if("_add_"===e(this).val()){var i=e(this).find("option"),n=i.size(),o=prompt(a.promptMsg,"");o?(t.val(o),i.eq(n-1).before('<option value="'+o+'" selected="selected">'+o+"</option>")):e(this).val(t.val())}else t.val(e(this).val());a.selected&&"function"==typeof a.selected&&a.selected(t.val())}));function b(e){var t=[];return e.match(/([^|]+)\|([^|]+)/)?(t[0]=RegExp.$1,t[1]=RegExp.$2):(t[0]=e,t[1]=e),t}a.separateMode&&g.find("option").last().remove(),t.after(g)}))},overlayEditor:function(){return this.each((function(){var t=this.value,a=e(this).hide(),i=a.attr("id");i||(i=mtapp.temporaryId(),a.attr("id",i)),a.after('<div id="'+i+'-view" class="mtapp-overlay-editor">'+t+'</div><button id="'+i+'-button" type="button" class="btn btn-default mt-3">編集</button>'),e("#"+i+"-button").on("click",(function(){var t=e(this).attr("id").replace(/-button/,""),a=document.getElementById(t).value;mtapp.overlayEditor.open(t,a)}))}))}};e.fn.mtapp=function(e){if("list"===e){var t=["==================\n.mtapp method list\n=================="];for(var i in a)t.push(i);return console.warn(t.join("\n")),!0}return a[e]?a[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==_typeof(e)&&e?void alert('Oops! "'+e+'" does not exist on MTAppjQuery.'):a.init.apply(this,arguments)}}(jQuery,window.mtappVars),function(e){e.fn.extend({hasClasses:function(e){"string"==typeof e&&(e=e.trim(),e=/^\./.test(e)?e.replace(/^\./,"").split("."):e.split(/\s+/));for(var t=e.length,a=0,i=0;i<t;i++)this.hasClass(e[i])&&a++;return t===a},notClasses:function(e){return!this.hasClasses(e)},noScroll:function(t,a){if(!(this.length<1))return a&&e(a).css("overflow-y","hidden"),this.each((function(){var a=e(this),i=a.parent().css("position","relative"),n=i.height(),o=e(document);i.height(n),a.css({position:"absolute","z-index":9999}),t&&a.css(t),e(window).scroll((function(){var e=o.scrollTop()-i.offset().top+10;e<0&&(e=0),o.height()-o.scrollTop()<a.height()||a.stop().animate({top:e+"px"},"fast","swing")}))}))},insertAtCaret:function(t){return this.each((function(){var a=e(this)[0];if(a.trigger("focus"),void 0!==document.selection){var i=document.selection.createRange();i.text=t,i.select()}else{var n=a.value,o=a.selectionStart,l=o+t.length;a.value=n.substr(0,o)+t+n.substr(o),a.setSelectionRange(l,l)}}))}})}(jQuery);